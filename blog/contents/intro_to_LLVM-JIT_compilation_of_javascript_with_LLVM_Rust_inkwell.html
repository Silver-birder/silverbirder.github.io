<!DOCTYPE html><html ⚡ lang="ja" i-amphtml-layout i-amphtml-no-boilerplate transformed="self;v=1"><head><meta charset="utf-8"><style amp-runtime i-amphtml-version="012110011758000">html{overflow-x:hidden!important}html.i-amphtml-fie{height:100%!important;width:100%!important}html:not([amp4ads]),html:not([amp4ads]) body{height:auto!important}html:not([amp4ads]) body{margin:0!important}body{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%}html.i-amphtml-singledoc.i-amphtml-embedded{-ms-touch-action:pan-y pinch-zoom;touch-action:pan-y pinch-zoom}html.i-amphtml-fie>body,html.i-amphtml-singledoc>body{overflow:visible!important}html.i-amphtml-fie:not(.i-amphtml-inabox)>body,html.i-amphtml-singledoc:not(.i-amphtml-inabox)>body{position:relative!important}html.i-amphtml-ios-embed-legacy>body{overflow-x:hidden!important;overflow-y:auto!important;position:absolute!important}html.i-amphtml-ios-embed{overflow-y:auto!important;position:static}#i-amphtml-wrapper{overflow-x:hidden!important;overflow-y:auto!important;position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;margin:0!important;display:block!important}html.i-amphtml-ios-embed.i-amphtml-ios-overscroll,html.i-amphtml-ios-embed.i-amphtml-ios-overscroll>#i-amphtml-wrapper{-webkit-overflow-scrolling:touch!important}#i-amphtml-wrapper>body{position:relative!important;border-top:1px solid transparent!important}#i-amphtml-wrapper+body{visibility:visible}#i-amphtml-wrapper+body .i-amphtml-lightbox-element,#i-amphtml-wrapper+body[i-amphtml-lightbox]{visibility:hidden}#i-amphtml-wrapper+body[i-amphtml-lightbox] .i-amphtml-lightbox-element{visibility:visible}#i-amphtml-wrapper.i-amphtml-scroll-disabled,.i-amphtml-scroll-disabled{overflow-x:hidden!important;overflow-y:hidden!important}amp-instagram{padding:54px 0px 0px!important;background-color:#fff}amp-iframe iframe{box-sizing:border-box!important}[amp-access][amp-access-hide]{display:none}[subscriptions-dialog],body:not(.i-amphtml-subs-ready) [subscriptions-action],body:not(.i-amphtml-subs-ready) [subscriptions-section]{display:none!important}amp-experiment,amp-live-list>[update]{display:none}amp-list[resizable-children]>.i-amphtml-loading-container.amp-hidden{display:none!important}amp-list [fetch-error],amp-list[load-more] [load-more-button],amp-list[load-more] [load-more-end],amp-list[load-more] [load-more-failed],amp-list[load-more] [load-more-loading]{display:none}amp-list[diffable] div[role=list]{display:block}amp-story-page,amp-story[standalone]{min-height:1px!important;display:block!important;height:100%!important;margin:0!important;padding:0!important;overflow:hidden!important;width:100%!important}amp-story[standalone]{background-color:#000!important;position:relative!important}amp-story-page{background-color:#757575}amp-story .amp-active>div,amp-story .i-amphtml-loader-background{display:none!important}amp-story-page:not(:first-of-type):not([distance]):not([active]){transform:translateY(1000vh)!important}amp-autocomplete{position:relative!important;display:inline-block!important}amp-autocomplete>input,amp-autocomplete>textarea{padding:0.5rem;border:1px solid rgba(0,0,0,0.33)}.i-amphtml-autocomplete-results,amp-autocomplete>input,amp-autocomplete>textarea{font-size:1rem;line-height:1.5rem}[amp-fx^=fly-in]{visibility:hidden}amp-script[nodom],amp-script[sandboxed]{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}
/*# sourceURL=/css/ampdoc.css*/[hidden]{display:none!important}.i-amphtml-element{display:inline-block}.i-amphtml-blurry-placeholder{transition:opacity 0.3s cubic-bezier(0.0,0.0,0.2,1)!important;pointer-events:none}[layout=nodisplay]:not(.i-amphtml-element){display:none!important}.i-amphtml-layout-fixed,[layout=fixed][width][height]:not(.i-amphtml-layout-fixed){display:inline-block;position:relative}.i-amphtml-layout-responsive,[layout=responsive][width][height]:not(.i-amphtml-layout-responsive),[width][height][heights]:not([layout]):not(.i-amphtml-layout-responsive),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-layout-responsive){display:block;position:relative}.i-amphtml-layout-intrinsic,[layout=intrinsic][width][height]:not(.i-amphtml-layout-intrinsic){display:inline-block;position:relative;max-width:100%}.i-amphtml-layout-intrinsic .i-amphtml-sizer{max-width:100%}.i-amphtml-intrinsic-sizer{max-width:100%;display:block!important}.i-amphtml-layout-container,.i-amphtml-layout-fixed-height,[layout=container],[layout=fixed-height][height]:not(.i-amphtml-layout-fixed-height){display:block;position:relative}.i-amphtml-layout-fill,.i-amphtml-layout-fill.i-amphtml-notbuilt,[layout=fill]:not(.i-amphtml-layout-fill),body noscript>*{display:block;overflow:hidden!important;position:absolute;top:0;left:0;bottom:0;right:0}body noscript>*{position:absolute!important;width:100%;height:100%;z-index:2}body noscript{display:inline!important}.i-amphtml-layout-flex-item,[layout=flex-item]:not(.i-amphtml-layout-flex-item){display:block;position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.i-amphtml-layout-fluid{position:relative}.i-amphtml-layout-size-defined{overflow:hidden!important}.i-amphtml-layout-awaiting-size{position:absolute!important;top:auto!important;bottom:auto!important}i-amphtml-sizer{display:block!important}@supports (aspect-ratio:1/1){i-amphtml-sizer.i-amphtml-disable-ar{display:none!important}}.i-amphtml-blurry-placeholder,.i-amphtml-fill-content{display:block;height:0;max-height:100%;max-width:100%;min-height:100%;min-width:100%;width:0;margin:auto}.i-amphtml-layout-size-defined .i-amphtml-fill-content{position:absolute;top:0;left:0;bottom:0;right:0}.i-amphtml-replaced-content,.i-amphtml-screen-reader{padding:0!important;border:none!important}.i-amphtml-screen-reader{position:fixed!important;top:0px!important;left:0px!important;width:4px!important;height:4px!important;opacity:0!important;overflow:hidden!important;margin:0!important;display:block!important;visibility:visible!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:8px!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:12px!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:16px!important}.i-amphtml-unresolved{position:relative;overflow:hidden!important}.i-amphtml-select-disabled{-webkit-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.i-amphtml-notbuilt,[layout]:not(.i-amphtml-element),[width][height][heights]:not([layout]):not(.i-amphtml-element),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-element){position:relative;overflow:hidden!important;color:transparent!important}.i-amphtml-notbuilt:not(.i-amphtml-layout-container)>*,[layout]:not([layout=container]):not(.i-amphtml-element)>*,[width][height][heights]:not([layout]):not(.i-amphtml-element)>*,[width][height][sizes]:not([layout]):not(.i-amphtml-element)>*{display:none}amp-img:not(.i-amphtml-element)[i-amphtml-ssr]>img.i-amphtml-fill-content{display:block}.i-amphtml-notbuilt:not(.i-amphtml-layout-container),[layout]:not([layout=container]):not(.i-amphtml-element),[width][height][heights]:not([layout]):not(.i-amphtml-element),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-element){color:transparent!important;line-height:0!important}.i-amphtml-ghost{visibility:hidden!important}.i-amphtml-element>[placeholder],[layout]:not(.i-amphtml-element)>[placeholder],[width][height][heights]:not([layout]):not(.i-amphtml-element)>[placeholder],[width][height][sizes]:not([layout]):not(.i-amphtml-element)>[placeholder]{display:block;line-height:normal}.i-amphtml-element>[placeholder].amp-hidden,.i-amphtml-element>[placeholder].hidden{visibility:hidden}.i-amphtml-element:not(.amp-notsupported)>[fallback],.i-amphtml-layout-container>[placeholder].amp-hidden,.i-amphtml-layout-container>[placeholder].hidden{display:none}.i-amphtml-layout-size-defined>[fallback],.i-amphtml-layout-size-defined>[placeholder]{position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;z-index:1}amp-img[i-amphtml-ssr]:not(.i-amphtml-element)>[placeholder]{z-index:auto}.i-amphtml-notbuilt>[placeholder]{display:block!important}.i-amphtml-hidden-by-media-query{display:none!important}.i-amphtml-element-error{background:red!important;color:#fff!important;position:relative!important}.i-amphtml-element-error:before{content:attr(error-message)}i-amp-scroll-container,i-amphtml-scroll-container{position:absolute;top:0;left:0;right:0;bottom:0;display:block}i-amp-scroll-container.amp-active,i-amphtml-scroll-container.amp-active{overflow:auto;-webkit-overflow-scrolling:touch}.i-amphtml-loading-container{display:block!important;pointer-events:none;z-index:1}.i-amphtml-notbuilt>.i-amphtml-loading-container{display:block!important}.i-amphtml-loading-container.amp-hidden{visibility:hidden}.i-amphtml-element>[overflow]{cursor:pointer;position:relative;z-index:2;visibility:hidden;display:initial;line-height:normal}.i-amphtml-layout-size-defined>[overflow]{position:absolute}.i-amphtml-element>[overflow].amp-visible{visibility:visible}template{display:none!important}.amp-border-box,.amp-border-box *,.amp-border-box :after,.amp-border-box :before{box-sizing:border-box}amp-pixel{display:none!important}amp-analytics,amp-auto-ads,amp-story-auto-ads{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}html.i-amphtml-fie>amp-analytics{position:initial!important}[visible-when-invalid]:not(.visible),form [submit-error],form [submit-success],form [submitting]{display:none}amp-accordion{display:block!important}@media (min-width:1px){:where(amp-accordion>section)>:first-child{margin:0;background-color:#efefef;padding-right:20px;border:1px solid #dfdfdf}:where(amp-accordion>section)>:last-child{margin:0}}amp-accordion>section{float:none!important}amp-accordion>section>*{float:none!important;display:block!important;overflow:hidden!important;position:relative!important}amp-accordion,amp-accordion>section{margin:0}amp-accordion:not(.i-amphtml-built)>section>:last-child{display:none!important}amp-accordion:not(.i-amphtml-built)>section[expanded]>:last-child{display:block!important}
/*# sourceURL=/css/ampshared.css*/</style><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preload" href="https://cdn.ampproject.org/v0.js" as="script"><meta name="description" content="コンパイラ基盤であるLLVMについて、全く知識がない私が、 javascriptソースコードをパースしLLVMでコンパイルできるようになりました。 LLVMの記事は数多くありますが、初心者向けの記事が少なく感じたため、 本記事では、できる限"><meta property="og:image" content="https://res.cloudinary.com/silverbirder/image/fetch/f_auto,w_500/w_500,b_black,co_white,c_fit,g_north,l_text:Arial_30_bold_center:silverbirder/w_500,h_50,b_black,co_white,c_fit,g_south,l_text:Arial_20_bold:LLVM%E5%85%A5%E9%96%80%20-%20javascript%E3%82%92LLVM(Rust%3Ainkwell)%E3%81%A7JIT%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%99%E3%82%8B%E3%81%BE%E3%81%A7/https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuIfAJIv9p4lFILLutBJtSVEUnqqx7pTj1Z6QEv4adwwT_hH_wOlbYv_Dcu0a_6nvzxDfxJY4dyrPWIJsPCVQbzCclrZHy6BLF1HRePOzdpB_MSS4BYvCPoZesg7QZym1IQAu0fc3a0Iv1Su22QCu1va3aaHtb4DgNWemi000"><meta property="og:url" content="https://silver-birder.github.io/blog/contents/intro_to_LLVM-JIT_compilation_of_javascript_with_LLVM_Rust_inkwell"><meta property="og:site_name" content="silverbirder's page"><meta property="og:title" content="LLVM入門 - javascriptをLLVM(Rust:inkwell)でJITコンパイルするまで"><meta property="og:description" content="コンパイラ基盤であるLLVMについて、全く知識がない私が、 javascriptソースコードをパースしLLVMでコンパイルできるようになりました。 LLVMの記事は数多くありますが、初心者向けの記事が少なく感じたため、 本記事では、できる限"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="LLVM入門 - javascriptをLLVM(Rust:inkwell)でJITコンパイルするまで"><meta name="twitter:image" content="https://res.cloudinary.com/silverbirder/image/fetch/f_auto,w_500/w_500,b_black,co_white,c_fit,g_north,l_text:Arial_30_bold_center:silverbirder/w_500,h_50,b_black,co_white,c_fit,g_south,l_text:Arial_20_bold:LLVM%E5%85%A5%E9%96%80%20-%20javascript%E3%82%92LLVM(Rust%3Ainkwell)%E3%81%A7JIT%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%99%E3%82%8B%E3%81%BE%E3%81%A7/https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuIfAJIv9p4lFILLutBJtSVEUnqqx7pTj1Z6QEv4adwwT_hH_wOlbYv_Dcu0a_6nvzxDfxJY4dyrPWIJsPCVQbzCclrZHy6BLF1HRePOzdpB_MSS4BYvCPoZesg7QZym1IQAu0fc3a0Iv1Su22QCu1va3aaHtb4DgNWemi000"><meta name="twitter:site" content="silver_birder"><meta property="fb:app_id" content="757288804895366"><script data-auto async src="https://cdn.ampproject.org/v0.js"></script><script async src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js" custom-element="amp-analytics"></script><script async src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js" custom-element="amp-social-share"></script><script async src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js" custom-element="amp-sidebar"></script><link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🦀</text></svg>"><link rel="preload" href="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuIfAJIv9p4lFILLutBJtSVEUnqqx7pTj1Z6QEv4adwwT_hH_wOlbYv_Dcu0a_6nvzxDfxJY4dyrPWIJsPCVQbzCclrZHy6BLF1HRePOzdpB_MSS4BYvCPoZesg7QZym1IQAu0fc3a0Iv1Su22QCu1va3aaHtb4DgNWemi000" as="image" data-hero><link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300" rel="stylesheet"><link href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" rel="stylesheet"><link href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.14.0/devicon.min.css" rel="stylesheet"><link rel="preconnect dns-prefetch" href="https://fonts.gstatic.com/" crossorigin><style amp-custom>*{font-family:Ubuntu,sans-serif}@font-face{font-family:FontAwesome;src:url(https://somedomain.org/fonts/fontawesome-webfont.ttf)}:root{color-scheme:light dark;--blue:#0084b4;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:beige;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#212529;--primary:#0084b4;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:beige;--danger:#dc3545;--light:#dee2e6;--dark:#212529;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:"Roboto Condensed",sans-serif;--font-family-monospace:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}@media (prefers-color-scheme:dark){.bg-warning{color:#212529}#sidebar{background:#212529}}.sidebar-close{background:transparent}@media (prefers-color-scheme:dark){.sidebar-close{color:#f8f9fa}}*,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}article,aside,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}body{margin:0;font-family:Roboto Condensed,sans-serif;font-weight:400;line-height:1.5;text-align:left;font-size:1rem}@media (prefers-color-scheme:light){body{color:#212529;background-color:#fff}}@media (prefers-color-scheme:dark){body{color:#f8f9fa;background-color:#212529}}[tabindex="-1"]:focus:not(:focus-visible){outline:0}hr{box-sizing:content-box;height:0;overflow:visible}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}abbr[data-original-title],abbr[title]{text-decoration:underline;text-decoration:underline dotted;border-bottom:0;text-decoration-skip-ink:none;cursor:help}address{font-style:normal;line-height:inherit}address,dl,ol,ul{margin-bottom:1rem}dl,ol,ul{margin-top:0}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:700}small{font-size:80%}sub,sup{position:relative;line-height:0;vertical-align:baseline;font-size:75%}sub{bottom:-.25em}sup{top:-.5em}a{background:transparent}@media (prefers-color-scheme:light){a{color:#212529}}@media (prefers-color-scheme:dark){a{color:#f8f9fa}}a:hover{text-decoration:underline}@media (prefers-color-scheme:light){a:hover{color:#000}}@media (prefers-color-scheme:dark){a:hover{color:#cbd3da}}a:not([href]){color:inherit;text-decoration:none}a:not([href]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}figure{margin:0 0 1rem}img{border-style:none}img,svg{vertical-align:middle}svg{overflow:hidden}table{border-collapse:collapse}caption{padding-top:.75rem;padding-bottom:.75rem;text-align:left;caption-side:bottom}@media (prefers-color-scheme:light){caption{color:#6c757d}}@media (prefers-color-scheme:dark){caption{color:#6c757d}}th{text-align:inherit}label{display:inline-block;margin-bottom:.5rem}button{border-radius:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}button,input,optgroup,select,textarea{margin:0;font-family:inherit;line-height:inherit;font-size:inherit}button,input{overflow:visible}button,select{text-transform:none}select{word-wrap:normal}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{padding:0;border-style:none}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=date],input[type=datetime-local],input[type=month],input[type=time]{-webkit-appearance:listbox}textarea{overflow:auto;resize:vertical}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:none}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}summary{display:list-item;cursor:pointer}template{display:none}[hidden]{display:none}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{margin-bottom:.5rem;font-weight:400;line-height:1.2}.h1,h1{font-size:2.5rem}@media (max-width:1200px){.h1,h1{font-size:calc(1.375rem + 1.5vw)}}.h2,h2{font-size:2rem}@media (max-width:1200px){.h2,h2{font-size:calc(1.325rem + .9vw)}}.h3,h3{font-size:1.25rem}.h4,h4{font-size:1.15rem}.h5,.h6,h5,h6{font-size:1rem}.lead{font-weight:400;font-size:1.25rem}hr{margin-top:1rem;margin-bottom:1rem;border:0}@media (prefers-color-scheme:light){hr{border-top:1px solid rgba(0,0,0,.1)}}@media (prefers-color-scheme:dark){hr{border-top:1px solid rgba(222,226,230,.1)}}.blockquote{margin-bottom:1rem;padding-left:1rem;border-left:5px solid #0084b4;font-size:1rem}.blockquote i{float:right;font-style:italic;font-size:.875rem}.blockquote-footer{display:block;font-size:80%}@media (prefers-color-scheme:light){.blockquote-footer{color:#6c757d}}@media (prefers-color-scheme:dark){.blockquote-footer{color:#ced4da}}amp-img,img{border:0}amp-img[class^=-amp],amp-img[class^=i-amp]{height:auto;max-width:100%}code{font-size:.875rem;color:#e83e8c;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875rem;color:#212529;background:#dee2e6;border-radius:.2rem}kbd kbd{padding:0;font-size:100%;font-weight:700}pre{display:block;font-size:.875rem}@media (prefers-color-scheme:light){pre{color:#212529;background-color:#e9ecef;border:1px solid #dee2e6}}@media (prefers-color-scheme:dark){pre{color:#f8f9fa;background-color:#343a40;border:1px solid #343a40}}pre code{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;color:inherit;word-break:normal;font-size:75%}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media (min-width:576px){.container{max-width:540px}}@media (min-width:768px){.container{max-width:720px}}@media (min-width:992px){.container{max-width:960px}}@media (min-width:1200px){.container{max-width:1140px}}.container-fluid,.container-lg,.container-md,.container-sm,.container-xl{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media (min-width:576px){.container,.container-sm{max-width:540px}}@media (min-width:768px){.container,.container-md,.container-sm{max-width:720px}}@media (min-width:992px){.container,.container-lg,.container-md,.container-sm{max-width:960px}}@media (min-width:1200px){.container,.container-lg,.container-md,.container-sm,.container-xl{max-width:1140px}}.row{display:flex;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.col,.col-1,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-10,.col-11,.col-12,.col-auto,.col-lg,.col-lg-1,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-auto,.col-md,.col-md-1,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-10,.col-md-11,.col-md-12,.col-md-auto,.col-sm,.col-sm-1,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-auto,.col-xl,.col-xl-1,.col-xl-2,.col-xl-3,.col-xl-4,.col-xl-5,.col-xl-6,.col-xl-7,.col-xl-8,.col-xl-9,.col-xl-10,.col-xl-11,.col-xl-12,.col-xl-auto{position:relative;width:100%;padding-right:15px;padding-left:15px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-1{flex:0 0 8.33333%;max-width:8.33333%}.col-2{flex:0 0 16.66667%;max-width:16.66667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.33333%;max-width:33.33333%}.col-5{flex:0 0 41.66667%;max-width:41.66667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.33333%;max-width:58.33333%}.col-8{flex:0 0 66.66667%;max-width:66.66667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.33333%;max-width:83.33333%}.col-11{flex:0 0 91.66667%;max-width:91.66667%}.col-12{flex:0 0 100%;max-width:100%}@media (min-width:576px){.col-sm{flex-basis:0;flex-grow:1;max-width:100%}.col-sm-1{flex:0 0 8.33333%;max-width:8.33333%}.col-sm-2{flex:0 0 16.66667%;max-width:16.66667%}.col-sm-3{flex:0 0 25%;max-width:25%}.col-sm-4{flex:0 0 33.33333%;max-width:33.33333%}.col-sm-5{flex:0 0 41.66667%;max-width:41.66667%}.col-sm-6{flex:0 0 50%;max-width:50%}.col-sm-7{flex:0 0 58.33333%;max-width:58.33333%}.col-sm-8{flex:0 0 66.66667%;max-width:66.66667%}.col-sm-9{flex:0 0 75%;max-width:75%}.col-sm-10{flex:0 0 83.33333%;max-width:83.33333%}.col-sm-11{flex:0 0 91.66667%;max-width:91.66667%}.col-sm-12{flex:0 0 100%;max-width:100%}}@media (min-width:768px){.col-md{flex-basis:0;flex-grow:1;max-width:100%}.col-md-1{flex:0 0 8.33333%;max-width:8.33333%}.col-md-2{flex:0 0 16.66667%;max-width:16.66667%}.col-md-3{flex:0 0 25%;max-width:25%}.col-md-4{flex:0 0 33.33333%;max-width:33.33333%}.col-md-5{flex:0 0 41.66667%;max-width:41.66667%}.col-md-6{flex:0 0 50%;max-width:50%}.col-md-7{flex:0 0 58.33333%;max-width:58.33333%}.col-md-8{flex:0 0 66.66667%;max-width:66.66667%}.col-md-9{flex:0 0 75%;max-width:75%}.col-md-10{flex:0 0 83.33333%;max-width:83.33333%}.col-md-11{flex:0 0 91.66667%;max-width:91.66667%}.col-md-12{flex:0 0 100%;max-width:100%}}@media (min-width:992px){.col-lg{flex-basis:0;flex-grow:1;max-width:100%}.col-lg-1{flex:0 0 8.33333%;max-width:8.33333%}.col-lg-2{flex:0 0 16.66667%;max-width:16.66667%}.col-lg-3{flex:0 0 25%;max-width:25%}.col-lg-4{flex:0 0 33.33333%;max-width:33.33333%}.col-lg-5{flex:0 0 41.66667%;max-width:41.66667%}.col-lg-6{flex:0 0 50%;max-width:50%}.col-lg-7{flex:0 0 58.33333%;max-width:58.33333%}.col-lg-8{flex:0 0 66.66667%;max-width:66.66667%}.col-lg-9{flex:0 0 75%;max-width:75%}.col-lg-10{flex:0 0 83.33333%;max-width:83.33333%}.col-lg-11{flex:0 0 91.66667%;max-width:91.66667%}.col-lg-12{flex:0 0 100%;max-width:100%}}@media (min-width:1200px){.col-xl{flex-basis:0;flex-grow:1;max-width:100%}.col-xl-1{flex:0 0 8.33333%;max-width:8.33333%}.col-xl-2{flex:0 0 16.66667%;max-width:16.66667%}.col-xl-3{flex:0 0 25%;max-width:25%}.col-xl-4{flex:0 0 33.33333%;max-width:33.33333%}.col-xl-5{flex:0 0 41.66667%;max-width:41.66667%}.col-xl-6{flex:0 0 50%;max-width:50%}.col-xl-7{flex:0 0 58.33333%;max-width:58.33333%}.col-xl-8{flex:0 0 66.66667%;max-width:66.66667%}.col-xl-9{flex:0 0 75%;max-width:75%}.col-xl-10{flex:0 0 83.33333%;max-width:83.33333%}.col-xl-11{flex:0 0 91.66667%;max-width:91.66667%}.col-xl-12{flex:0 0 100%;max-width:100%}}table{width:100%;margin-bottom:1rem}@media (prefers-color-scheme:light){table{color:#212529}}@media (prefers-color-scheme:dark){table{color:#f8f9fa}}table td,table th{padding:.75rem;vertical-align:top}@media (prefers-color-scheme:light){table td,table th{border-top:1px solid #dee2e6}}@media (prefers-color-scheme:dark){table td,table th{border-top:1px solid #343a40}}table thead th{vertical-align:bottom}@media (prefers-color-scheme:light){table thead th{border-bottom:2px solid #dee2e6}}@media (prefers-color-scheme:dark){table thead th{border-bottom:2px solid #343a40}}@media (prefers-color-scheme:light){table tbody+tbody{border-top:2px solid #dee2e6}}@media (prefers-color-scheme:dark){table tbody+tbody{border-top:2px solid #343a40}}.form-control{display:block;width:100%;height:calc(1.5em + .75rem + 2px);padding:.375rem .75rem;font-weight:400;line-height:1.5;background-clip:padding-box;appearance:none;font-size:1rem;border-radius:.25rem}@media (prefers-color-scheme:light){.form-control{color:#495057;background:#fff;border:1px solid #ced4da}}@media (prefers-color-scheme:dark){.form-control{color:#dee2e6;background:#212529;border:1px solid #6c757d}}.form-control::-ms-expand{background:transparent;border:0}.form-control:-moz-focusring{color:transparent;text-shadow:0 0 0 #495057}.form-control:focus{color:#495057;background:#fff;border-color:#35c9ff;outline:0;box-shadow:0 0 0 .2rem rgba(0,132,180,.25)}.form-control::placeholder{opacity:1}@media (prefers-color-scheme:light){.form-control::placeholder{color:#6c757d}}@media (prefers-color-scheme:dark){.form-control::placeholder{color:#ced4da}}.form-control:disabled,.form-control[readonly]{opacity:1}@media (prefers-color-scheme:light){.form-control:disabled,.form-control[readonly]{background:#e9ecef}}@media (prefers-color-scheme:dark){.form-control:disabled,.form-control[readonly]{background:#343a40}}select.form-control{background-size:.5rem}@media (prefers-color-scheme:light){select.form-control{background:#fff url(https://ampcssframework.com/assets/icons/chevron-down.svg) no-repeat right 1rem center}}@media (prefers-color-scheme:dark){select.form-control{background:#212529 url(https://ampcssframework.com/assets/icons/chevron-down.svg) no-repeat right 1rem center}}@media (prefers-color-scheme:light){select.form-control:focus::-ms-value{color:#495057;background:#fff}}@media (prefers-color-scheme:dark){select.form-control:focus::-ms-value{color:#dee2e6;background:#212529}}.form-control-file,.form-control-range{display:block;width:100%}.col-form-label{padding-top:calc(.375rem + 1px);padding-bottom:calc(.375rem + 1px);margin-bottom:0;line-height:1.5;font-size:inherit}.form-control-plaintext{display:block;width:100%;padding:.375rem 0;margin-bottom:0;line-height:1.5;background:transparent;border:solid transparent;border-width:1px 0;font-size:1rem}@media (prefers-color-scheme:light){.form-control-plaintext{color:#212529}}@media (prefers-color-scheme:dark){.form-control-plaintext{color:#f8f9fa}}select.form-control[multiple],select.form-control[size]{height:auto}textarea.form-control{height:auto}.form-group{margin-bottom:1rem}.form-text{display:block;margin-top:.25rem}.form-row{display:flex;flex-wrap:wrap;margin-right:-5px;margin-left:-5px}.form-row>.col,.form-row>[class*=col-]{padding-right:5px;padding-left:5px}.valid-feedback{display:none;width:100%;margin-top:.25rem;font-size:80%;color:#28a745}.is-valid~.valid-feedback,.was-validated :valid~.valid-feedback{display:block}.form-control.is-valid,.was-validated .form-control:valid{border-color:#28a745}.form-control.is-valid:focus,.was-validated .form-control:valid:focus{border-color:#28a745;box-shadow:0 0 0 .2rem rgba(40,167,69,.25)}.form-check-input.is-valid~.form-check-label,.was-validated .form-check-input:valid~.form-check-label{color:#28a745}.form-check-input.is-valid~.valid-feedback,.was-validated .form-check-input:valid~.valid-feedback{display:block}.invalid-feedback{display:none;width:100%;margin-top:.25rem;font-size:80%;color:#dc3545}.is-invalid~.invalid-feedback,.was-validated :invalid~.invalid-feedback{display:block}.form-control.is-invalid,.was-validated .form-control:invalid{border-color:#dc3545}.form-control.is-invalid:focus,.was-validated .form-control:invalid:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem rgba(220,53,69,.25)}.form-check-input.is-invalid~.form-check-label,.was-validated .form-check-input:invalid~.form-check-label{color:#dc3545}.form-check-input.is-invalid~.invalid-feedback,.was-validated .form-check-input:invalid~.invalid-feedback{display:block}.form-inline{display:flex;flex-flow:row wrap;align-items:center}.form-inline .form-check{width:100%}@media (min-width:576px){.form-inline label{justify-content:center}.form-inline .form-group,.form-inline label{display:flex;align-items:center;margin-bottom:0}.form-inline .form-group{flex:0 0 auto;flex-flow:row wrap}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}.form-inline .form-control-plaintext{display:inline-block}.form-inline .input-group{width:auto}.form-inline .form-check{display:flex;align-items:center;justify-content:center;width:auto;padding-left:0}.form-inline .form-check-input{position:relative;flex-shrink:0;margin-top:0;margin-right:.25rem;margin-left:0}}.btn{display:inline-block;font-weight:400;color:#212529;text-align:center;vertical-align:middle;cursor:pointer;user-select:none;background:transparent;border:1px solid transparent;padding:.375rem .75rem;font-size:1rem;line-height:1.5;border-radius:.25rem}.btn:hover{color:#212529;text-decoration:none}.btn.focus,.btn:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,132,180,.25)}.btn.disabled,.btn:disabled{opacity:.65}a.btn.disabled,fieldset:disabled a.btn{pointer-events:none}.btn-primary{color:#fff;border-color:#0084b4;background:#0084b4}.btn-primary:hover{color:#fff;border-color:#005f81;background:#00688e}.btn-primary.focus,.btn-primary:focus{color:#fff;border-color:#005f81;background:#00688e;box-shadow:0 0 0 .2rem rgba(38,150,191,.5)}.btn-primary.disabled,.btn-primary:disabled{color:#fff;background:#0084b4;border-color:#0084b4}.btn-primary:not(:disabled):not(.disabled).active,.btn-primary:not(:disabled):not(.disabled):active,.show>.btn-primary.dropdown-toggle{color:#fff;background:#005f81;border-color:#005574}.btn-primary:not(:disabled):not(.disabled).active:focus,.btn-primary:not(:disabled):not(.disabled):active:focus,.show>.btn-primary.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(38,150,191,.5)}.btn-secondary{color:#fff;border-color:#6c757d;background:#6c757d}.btn-secondary:hover{color:#fff;border-color:#545b62;background:#5a6268}.btn-secondary.focus,.btn-secondary:focus{color:#fff;border-color:#545b62;background:#5a6268;box-shadow:0 0 0 .2rem rgba(130,138,145,.5)}.btn-secondary.disabled,.btn-secondary:disabled{color:#fff;background:#6c757d;border-color:#6c757d}.btn-secondary:not(:disabled):not(.disabled).active,.btn-secondary:not(:disabled):not(.disabled):active,.show>.btn-secondary.dropdown-toggle{color:#fff;background:#545b62;border-color:#4e555b}.btn-secondary:not(:disabled):not(.disabled).active:focus,.btn-secondary:not(:disabled):not(.disabled):active:focus,.show>.btn-secondary.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(130,138,145,.5)}.btn-success{color:#fff;border-color:#28a745;background:#28a745}.btn-success:hover{color:#fff;border-color:#1e7e34;background:#218838}.btn-success.focus,.btn-success:focus{color:#fff;border-color:#1e7e34;background:#218838;box-shadow:0 0 0 .2rem rgba(72,180,97,.5)}.btn-success.disabled,.btn-success:disabled{color:#fff;background:#28a745;border-color:#28a745}.btn-success:not(:disabled):not(.disabled).active,.btn-success:not(:disabled):not(.disabled):active,.show>.btn-success.dropdown-toggle{color:#fff;background:#1e7e34;border-color:#1c7430}.btn-success:not(:disabled):not(.disabled).active:focus,.btn-success:not(:disabled):not(.disabled):active:focus,.show>.btn-success.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(72,180,97,.5)}.btn-info{color:#fff;border-color:#17a2b8;background:#17a2b8}.btn-info:hover{color:#fff;border-color:#117a8b;background:#138496}.btn-info.focus,.btn-info:focus{color:#fff;border-color:#117a8b;background:#138496;box-shadow:0 0 0 .2rem rgba(58,176,195,.5)}.btn-info.disabled,.btn-info:disabled{color:#fff;background:#17a2b8;border-color:#17a2b8}.btn-info:not(:disabled):not(.disabled).active,.btn-info:not(:disabled):not(.disabled):active,.show>.btn-info.dropdown-toggle{color:#fff;background:#117a8b;border-color:#10707f}.btn-info:not(:disabled):not(.disabled).active:focus,.btn-info:not(:disabled):not(.disabled):active:focus,.show>.btn-info.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(58,176,195,.5)}.btn-warning{color:#212529;border-color:beige;background:beige}.btn-warning:hover{color:#212529;border-color:#eaeab4;background:#ededbe}.btn-warning.focus,.btn-warning:focus{color:#212529;border-color:#eaeab4;background:#ededbe;box-shadow:0 0 0 .2rem rgba(213,214,193,.5)}.btn-warning.disabled,.btn-warning:disabled{color:#212529;background:beige;border-color:beige}.btn-warning:not(:disabled):not(.disabled).active,.btn-warning:not(:disabled):not(.disabled):active,.show>.btn-warning.dropdown-toggle{color:#212529;background:#eaeab4;border-color:#e7e7aa}.btn-warning:not(:disabled):not(.disabled).active:focus,.btn-warning:not(:disabled):not(.disabled):active:focus,.show>.btn-warning.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(213,214,193,.5)}.btn-danger{color:#fff;border-color:#dc3545;background:#dc3545}.btn-danger:hover{color:#fff;border-color:#bd2130;background:#c82333}.btn-danger.focus,.btn-danger:focus{color:#fff;border-color:#bd2130;background:#c82333;box-shadow:0 0 0 .2rem rgba(225,83,97,.5)}.btn-danger.disabled,.btn-danger:disabled{color:#fff;background:#dc3545;border-color:#dc3545}.btn-danger:not(:disabled):not(.disabled).active,.btn-danger:not(:disabled):not(.disabled):active,.show>.btn-danger.dropdown-toggle{color:#fff;background:#bd2130;border-color:#b21f2d}.btn-danger:not(:disabled):not(.disabled).active:focus,.btn-danger:not(:disabled):not(.disabled):active:focus,.show>.btn-danger.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(225,83,97,.5)}.btn-light{color:#212529;border-color:#dee2e6;background:#dee2e6}.btn-light:hover{color:#212529;border-color:#c1c9d0;background:#c8cfd6}.btn-light.focus,.btn-light:focus{color:#212529;border-color:#c1c9d0;background:#c8cfd6;box-shadow:0 0 0 .2rem rgba(194,198,202,.5)}.btn-light.disabled,.btn-light:disabled{color:#212529;background:#dee2e6;border-color:#dee2e6}.btn-light:not(:disabled):not(.disabled).active,.btn-light:not(:disabled):not(.disabled):active,.show>.btn-light.dropdown-toggle{color:#212529;background:#c1c9d0;border-color:#bac2cb}.btn-light:not(:disabled):not(.disabled).active:focus,.btn-light:not(:disabled):not(.disabled):active:focus,.show>.btn-light.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(194,198,202,.5)}.btn-dark{color:#fff;border-color:#212529;background:#212529}.btn-dark:hover{color:#fff;border-color:#0a0c0d;background:#101214}.btn-dark.focus,.btn-dark:focus{color:#fff;border-color:#0a0c0d;background:#101214;box-shadow:0 0 0 .2rem rgba(66,70,73,.5)}.btn-dark.disabled,.btn-dark:disabled{color:#fff;background:#212529;border-color:#212529}.btn-dark:not(:disabled):not(.disabled).active,.btn-dark:not(:disabled):not(.disabled):active,.show>.btn-dark.dropdown-toggle{color:#fff;background:#0a0c0d;border-color:#050506}.btn-dark:not(:disabled):not(.disabled).active:focus,.btn-dark:not(:disabled):not(.disabled):active:focus,.show>.btn-dark.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(66,70,73,.5)}.btn-outline-primary{color:#0084b4;border-color:#0084b4}.btn-outline-primary:hover{color:#fff;background:#0084b4;border-color:#0084b4}.btn-outline-primary.focus,.btn-outline-primary:focus{box-shadow:0 0 0 .2rem rgba(0,132,180,.5)}.btn-outline-primary.disabled,.btn-outline-primary:disabled{color:#0084b4;background:transparent}.btn-outline-primary:not(:disabled):not(.disabled).active,.btn-outline-primary:not(:disabled):not(.disabled):active,.show>.btn-outline-primary.dropdown-toggle{color:#fff;background:#0084b4;border-color:#0084b4}.btn-outline-primary:not(:disabled):not(.disabled).active:focus,.btn-outline-primary:not(:disabled):not(.disabled):active:focus,.show>.btn-outline-primary.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(0,132,180,.5)}.btn-outline-secondary{color:#6c757d;border-color:#6c757d}.btn-outline-secondary:hover{color:#fff;background:#6c757d;border-color:#6c757d}.btn-outline-secondary.focus,.btn-outline-secondary:focus{box-shadow:0 0 0 .2rem rgba(108,117,125,.5)}.btn-outline-secondary.disabled,.btn-outline-secondary:disabled{color:#6c757d;background:transparent}.btn-outline-secondary:not(:disabled):not(.disabled).active,.btn-outline-secondary:not(:disabled):not(.disabled):active,.show>.btn-outline-secondary.dropdown-toggle{color:#fff;background:#6c757d;border-color:#6c757d}.btn-outline-secondary:not(:disabled):not(.disabled).active:focus,.btn-outline-secondary:not(:disabled):not(.disabled):active:focus,.show>.btn-outline-secondary.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(108,117,125,.5)}.btn-outline-success{color:#28a745;border-color:#28a745}.btn-outline-success:hover{color:#fff;background:#28a745;border-color:#28a745}.btn-outline-success.focus,.btn-outline-success:focus{box-shadow:0 0 0 .2rem rgba(40,167,69,.5)}.btn-outline-success.disabled,.btn-outline-success:disabled{color:#28a745;background:transparent}.btn-outline-success:not(:disabled):not(.disabled).active,.btn-outline-success:not(:disabled):not(.disabled):active,.show>.btn-outline-success.dropdown-toggle{color:#fff;background:#28a745;border-color:#28a745}.btn-outline-success:not(:disabled):not(.disabled).active:focus,.btn-outline-success:not(:disabled):not(.disabled):active:focus,.show>.btn-outline-success.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(40,167,69,.5)}.btn-outline-info{color:#17a2b8;border-color:#17a2b8}.btn-outline-info:hover{color:#fff;background:#17a2b8;border-color:#17a2b8}.btn-outline-info.focus,.btn-outline-info:focus{box-shadow:0 0 0 .2rem rgba(23,162,184,.5)}.btn-outline-info.disabled,.btn-outline-info:disabled{color:#17a2b8;background:transparent}.btn-outline-info:not(:disabled):not(.disabled).active,.btn-outline-info:not(:disabled):not(.disabled):active,.show>.btn-outline-info.dropdown-toggle{color:#fff;background:#17a2b8;border-color:#17a2b8}.btn-outline-info:not(:disabled):not(.disabled).active:focus,.btn-outline-info:not(:disabled):not(.disabled):active:focus,.show>.btn-outline-info.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(23,162,184,.5)}.btn-outline-warning{color:beige;border-color:beige}.btn-outline-warning:hover{color:#212529;background:beige;border-color:beige}.btn-outline-warning.focus,.btn-outline-warning:focus{box-shadow:0 0 0 .2rem rgba(245,245,220,.5)}.btn-outline-warning.disabled,.btn-outline-warning:disabled{color:beige;background:transparent}.btn-outline-warning:not(:disabled):not(.disabled).active,.btn-outline-warning:not(:disabled):not(.disabled):active,.show>.btn-outline-warning.dropdown-toggle{color:#212529;background:beige;border-color:beige}.btn-outline-warning:not(:disabled):not(.disabled).active:focus,.btn-outline-warning:not(:disabled):not(.disabled):active:focus,.show>.btn-outline-warning.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(245,245,220,.5)}.btn-outline-danger{color:#dc3545;border-color:#dc3545}.btn-outline-danger:hover{color:#fff;background:#dc3545;border-color:#dc3545}.btn-outline-danger.focus,.btn-outline-danger:focus{box-shadow:0 0 0 .2rem rgba(220,53,69,.5)}.btn-outline-danger.disabled,.btn-outline-danger:disabled{color:#dc3545;background:transparent}.btn-outline-danger:not(:disabled):not(.disabled).active,.btn-outline-danger:not(:disabled):not(.disabled):active,.show>.btn-outline-danger.dropdown-toggle{color:#fff;background:#dc3545;border-color:#dc3545}.btn-outline-danger:not(:disabled):not(.disabled).active:focus,.btn-outline-danger:not(:disabled):not(.disabled):active:focus,.show>.btn-outline-danger.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(220,53,69,.5)}.btn-outline-light{color:#dee2e6;border-color:#dee2e6}.btn-outline-light:hover{color:#212529;background:#dee2e6;border-color:#dee2e6}.btn-outline-light.focus,.btn-outline-light:focus{box-shadow:0 0 0 .2rem rgba(222,226,230,.5)}.btn-outline-light.disabled,.btn-outline-light:disabled{color:#dee2e6;background:transparent}.btn-outline-light:not(:disabled):not(.disabled).active,.btn-outline-light:not(:disabled):not(.disabled):active,.show>.btn-outline-light.dropdown-toggle{color:#212529;background:#dee2e6;border-color:#dee2e6}.btn-outline-light:not(:disabled):not(.disabled).active:focus,.btn-outline-light:not(:disabled):not(.disabled):active:focus,.show>.btn-outline-light.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(222,226,230,.5)}.btn-outline-dark{color:#212529;border-color:#212529}.btn-outline-dark:hover{color:#fff;background:#212529;border-color:#212529}.btn-outline-dark.focus,.btn-outline-dark:focus{box-shadow:0 0 0 .2rem rgba(33,37,41,.5)}.btn-outline-dark.disabled,.btn-outline-dark:disabled{color:#212529;background:transparent}.btn-outline-dark:not(:disabled):not(.disabled).active,.btn-outline-dark:not(:disabled):not(.disabled):active,.show>.btn-outline-dark.dropdown-toggle{color:#fff;background:#212529;border-color:#212529}.btn-outline-dark:not(:disabled):not(.disabled).active:focus,.btn-outline-dark:not(:disabled):not(.disabled):active:focus,.show>.btn-outline-dark.dropdown-toggle:focus{box-shadow:0 0 0 .2rem rgba(33,37,41,.5)}.btn-link{font-weight:400;color:#212529;text-decoration:none}.btn-link:hover{color:#000;text-decoration:underline}.btn-link.focus,.btn-link:focus{text-decoration:underline;box-shadow:none}.btn-link.disabled,.btn-link:disabled{color:#6c757d;pointer-events:none}.input-group{position:relative;display:flex;flex-wrap:wrap;align-items:stretch;width:100%}.input-group>.form-control,.input-group>.form-control-plaintext{position:relative;flex:1 1 0%;min-width:0;margin-bottom:0}.input-group>.form-control+.form-control,.input-group>.form-control-plaintext+.form-control{margin-left:-1px}.input-group>.form-control:focus{z-index:3}.input-group>.form-control:not(:last-child){border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.form-control:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.input-group-append,.input-group-prepend{display:flex}.input-group-append .btn,.input-group-prepend .btn{position:relative;z-index:2}.input-group-append .btn:focus,.input-group-prepend .btn:focus{z-index:3}.input-group-append .btn+.btn,.input-group-append .btn+.input-group-text,.input-group-append .input-group-text+.btn,.input-group-append .input-group-text+.input-group-text,.input-group-prepend .btn+.btn,.input-group-prepend .btn+.input-group-text,.input-group-prepend .input-group-text+.btn,.input-group-prepend .input-group-text+.input-group-text{margin-left:-1px}.input-group-prepend{margin-right:-1px}.input-group-append{margin-left:-1px}.input-group-text{display:flex;align-items:center;padding:.375rem .75rem;margin-bottom:0;font-weight:400;line-height:1.5;text-align:center;white-space:nowrap;font-size:1rem;border-radius:.25rem}@media (prefers-color-scheme:light){.input-group-text{color:#495057;background:#e9ecef;border:1px solid #ced4da}}@media (prefers-color-scheme:dark){.input-group-text{color:#dee2e6;background:#343a40;border:1px solid #6c757d}}.input-group-text input[type=checkbox],.input-group-text input[type=radio]{margin-top:0}.input-group>.input-group-append:last-child>.btn:not(:last-child):not(.dropdown-toggle),.input-group>.input-group-append:last-child>.input-group-text:not(:last-child),.input-group>.input-group-append:not(:last-child)>.btn,.input-group>.input-group-append:not(:last-child)>.input-group-text,.input-group>.input-group-prepend>.btn,.input-group>.input-group-prepend>.input-group-text{border-top-right-radius:0;border-bottom-right-radius:0}.input-group>.input-group-append>.btn,.input-group>.input-group-append>.input-group-text,.input-group>.input-group-prepend:first-child>.btn:not(:first-child),.input-group>.input-group-prepend:first-child>.input-group-text:not(:first-child),.input-group>.input-group-prepend:not(:first-child)>.btn,.input-group>.input-group-prepend:not(:first-child)>.input-group-text{border-top-left-radius:0;border-bottom-left-radius:0}.nav{flex-wrap:wrap;padding-left:0;margin-bottom:0;list-style:none}.card,.nav{display:flex}.card{position:relative;flex-direction:column;min-width:0;word-wrap:break-word;background-clip:border-box;border-radius:.25rem}@media (prefers-color-scheme:light){.card{color:#212529;background:#fff;border:1px solid #dee2e6}}@media (prefers-color-scheme:dark){.card{color:#f8f9fa;background:#212529;border:1px solid #343a40}}.card>hr{margin-right:0;margin-left:0}.card>.list-group:first-child .list-group-item:first-child{border-top-left-radius:.25rem;border-top-right-radius:.25rem}.card>.list-group:last-child .list-group-item:last-child{border-bottom-right-radius:.25rem;border-bottom-left-radius:.25rem}.card-body{flex:1 1 auto;min-height:1px;padding:1.25rem}@media (prefers-color-scheme:light){.card-body{color:#212529}}@media (prefers-color-scheme:dark){.card-body{color:#f8f9fa}}.card-footer{padding:.75rem 1.25rem}@media (prefers-color-scheme:light){.card-footer{background:rgba(0,0,0,.03);border-top:1px solid #dee2e6}}@media (prefers-color-scheme:dark){.card-footer{background:rgba(222,226,230,.03);border-top:1px solid #343a40}}.card-footer:last-child{border-radius:0 0 calc(.25rem - 1px) calc(.25rem - 1px)}.card-img-overlay{position:absolute;top:0;right:0;bottom:0;left:0;padding:1.25rem}.card-img,.card-img-bottom,.card-img-top{flex-shrink:0;width:100%}.card-img,.card-img-top{border-top-left-radius:calc(.25rem - 1px);border-top-right-radius:calc(.25rem - 1px)}.card-img,.card-img-bottom{border-bottom-right-radius:calc(.25rem - 1px);border-bottom-left-radius:calc(.25rem - 1px)}.pagination{display:flex;padding-left:0;list-style:none;border-radius:.25rem}.page-link{position:relative;display:block;padding:.5rem .75rem;margin-left:-1px;line-height:1.25}@media (prefers-color-scheme:light){.page-link{color:#212529;background:#fff;border:1px solid #dee2e6}}@media (prefers-color-scheme:dark){.page-link{color:#f8f9fa;background:#212529;border:1px solid #495057}}.page-link:hover{z-index:2;text-decoration:none}@media (prefers-color-scheme:light){.page-link:hover{color:#000;background:#e9ecef;border-color:#dee2e6}}@media (prefers-color-scheme:dark){.page-link:hover{color:#cbd3da;background:#343a40;border-color:#495057}}.page-link:focus{z-index:3;outline:0;box-shadow:0 0 0 .2rem rgba(0,132,180,.25)}.page-item:first-child .page-link{margin-left:0;border-top-left-radius:.25rem;border-bottom-left-radius:.25rem}.page-item:last-child .page-link{border-top-right-radius:.25rem;border-bottom-right-radius:.25rem}.page-item.active .page-link{z-index:3}@media (prefers-color-scheme:light){.page-item.active .page-link{color:#fff;background:#0084b4;border-color:#0084b4}}@media (prefers-color-scheme:dark){.page-item.active .page-link{color:#212529;background:#0084b4;border-color:#0084b4}}.page-item.disabled .page-link{pointer-events:none;cursor:auto}@media (prefers-color-scheme:light){.page-item.disabled .page-link{color:#6c757d;background:#fff;border-color:#dee2e6}}@media (prefers-color-scheme:dark){.page-item.disabled .page-link{color:#ced4da;background:#212529;border-color:#495057}}.badge{display:inline-block;padding:.25em .4em;font-weight:400;line-height:1;text-align:center;white-space:nowrap;vertical-align:baseline;font-size:95%;border-radius:.25rem}a.badge:focus,a.badge:hover{text-decoration:none}.badge:empty{display:none}.btn .badge{position:relative;top:-2px;font-size:60%}.badge-pill{padding-right:.6em;padding-left:.6em;border-radius:10rem}.badge-primary{color:#fff;background:#0084b4}a.badge-primary:focus,a.badge-primary:hover{color:#fff;background:#005f81}a.badge-primary.focus,a.badge-primary:focus{outline:0;box-shadow:0 0 0 .2rem rgba(0,132,180,.5)}.badge-secondary{color:#fff;background:#6c757d}a.badge-secondary:focus,a.badge-secondary:hover{color:#fff;background:#545b62}a.badge-secondary.focus,a.badge-secondary:focus{outline:0;box-shadow:0 0 0 .2rem rgba(108,117,125,.5)}.badge-success{color:#fff;background:#28a745}a.badge-success:focus,a.badge-success:hover{color:#fff;background:#1e7e34}a.badge-success.focus,a.badge-success:focus{outline:0;box-shadow:0 0 0 .2rem rgba(40,167,69,.5)}.badge-info{color:#fff;background:#17a2b8}a.badge-info:focus,a.badge-info:hover{color:#fff;background:#117a8b}a.badge-info.focus,a.badge-info:focus{outline:0;box-shadow:0 0 0 .2rem rgba(23,162,184,.5)}.badge-warning{color:#212529;background:beige}a.badge-warning:focus,a.badge-warning:hover{color:#212529;background:#eaeab4}a.badge-warning.focus,a.badge-warning:focus{outline:0;box-shadow:0 0 0 .2rem rgba(245,245,220,.5)}.badge-danger{color:#fff;background:#dc3545}a.badge-danger:focus,a.badge-danger:hover{color:#fff;background:#bd2130}a.badge-danger.focus,a.badge-danger:focus{outline:0;box-shadow:0 0 0 .2rem rgba(220,53,69,.5)}.badge-light{color:#212529;background:#dee2e6}a.badge-light:focus,a.badge-light:hover{color:#212529;background:#c1c9d0}a.badge-light.focus,a.badge-light:focus{outline:0;box-shadow:0 0 0 .2rem rgba(222,226,230,.5)}.badge-dark{color:#fff;background:#212529}a.badge-dark:focus,a.badge-dark:hover{color:#fff;background:#0a0c0d}a.badge-dark.focus,a.badge-dark:focus{outline:0;box-shadow:0 0 0 .2rem rgba(33,37,41,.5)}header{width:100%;z-index:99999;top:0}@media (prefers-color-scheme:light){header.full-width{background:#fff}}@media (prefers-color-scheme:dark){header.full-width{background:#212529}}header.fixed{position:fixed}.mega-menu .header{flex:0 0 100%;max-width:100%;box-shadow:0 .25rem 1rem rgba(0,0,0,.15)}.mega-menu .header .container{padding-right:0;padding-left:0}.mega-menu .row-header,.mega-menu .row-stage{display:flex;flex-wrap:wrap}.mega-menu .logo{top:2px;position:relative;margin-left:40px}.mega-menu .img-logo{position:absolute}@media (min-width:768px){.mega-menu .img-logo{top:12px}}@media (max-width:991.98px){.mega-menu .img-logo{top:18px}}.mega-menu li,.mega-menu ol,.mega-menu ul{padding:0}.mega-menu #mobile:checked+.main-menu{display:block}.mega-menu #mobile-menu{position:relative;display:block;padding:16px;cursor:pointer}.mega-menu #mobile-menu span.main-menu-dropdown-icon{bottom:0;width:50px;cursor:pointer}.mega-menu #mobile-menu .main-menu-dropdown-icon,.mega-menu #mobile-menu span.main-menu-dropdown-icon{position:absolute;top:0;right:0}.mega-menu .main-menu{z-index:100;margin:auto}.mega-menu .main-menu:after,.mega-menu .main-menu:before{content:"";display:table;clear:both}.mega-menu .main-menu a{text-decoration:none}.mega-menu .main-menu li{position:relative;display:block}@media (prefers-color-scheme:light){.mega-menu .main-menu li{border-top:1px solid #dee2e6}}@media (prefers-color-scheme:dark){.mega-menu .main-menu li{border-top:1px solid #343a40}}.mega-menu .main-menu .main-menu{display:none;max-height:100%}.mega-menu .main-menu .main-menu-dropdown-list{display:none}.mega-menu .main-menu .main-menu-dropdown-list:not(.main-menu-dropdown-megamenu) a,.mega-menu .main-menu .main-menu-dropdown-list:not(.main-menu-dropdown-shop) a{transition:transform .25s ease-out;transform:translateZ(0)}.mega-menu .main-menu .main-menu-dropdown-list:not(.main-menu-dropdown-megamenu) a:hover,.mega-menu .main-menu .main-menu-dropdown-list:not(.main-menu-dropdown-shop) a:hover{transform:translate3d(3px,0,0)}.mega-menu .main-menu .main-menu-dropdown-list.main-menu-dropdown-megamenu li:first-child{font-weight:700;border-bottom:1px solid #dee2e6}.mega-menu .main-menu .main-menu-dropdown-list.main-menu-dropdown-megamenu li{border:none}.mega-menu .main-menu .main-menu-dropdown-item-subtitle{font-size:.75rem;text-indent:10px;margin-left:10px}.mega-menu .main-menu input[type=checkbox]:checked+.main-menu-dropdown-list{display:block}.mega-menu .main-menu input[type=checkbox],.mega-menu .main-menu ul span.main-menu-dropdown-icon{display:none}.mega-menu .main-menu label{margin-bottom:0}.mega-menu .main-menu label.main-menu-dropdown-icon{width:100%;height:50px;cursor:pointer;z-index:10}.mega-menu .main-menu label.main-menu-dropdown-icon,.mega-menu .main-menu li label.main-menu-dropdown-icon{position:absolute;top:0;right:0}.mega-menu .main-menu>ul>li{cursor:pointer}.mega-menu .main-menu>ul>li a{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:16px;cursor:pointer;position:relative;display:block}.mega-menu .main-menu .tip{padding:2px 5px;background:#0084b4;color:#fff;text-shadow:none;border-radius:3px;left:10px;position:relative;text-transform:uppercase;font-size:.75rem;top:-2px}.mega-menu .main-menu .tip:before{right:100%;top:50%;content:" ";height:0;width:0;position:absolute;pointer-events:none;border:5px solid hsla(0,0%,100%,0);border-right-color:#0084b4;margin-top:-5px}.mega-menu .main-menu .notification-info{position:absolute;width:100%;text-align:center;top:50%;margin-top:-4px;left:0;padding:0;display:block;line-height:1}.mega-menu .main-menu .notification-info .notification-qty{position:absolute;top:-12px;right:10px;width:15px;height:15px;display:block;font-size:.75rem;color:#fff;background-color:red;text-align:center;line-height:15px;border-radius:20px}@media (max-width:1199.98px){.header .main-menu .logo{top:3px}.header .main-menu span.logo{top:1px}.header .main-menu .fa{min-width:25px}}@media (max-width:1199.98px) and (prefers-color-scheme:light){.header .main-menu .active{color:#212529;background:#fff}}@media (max-width:1199.98px) and (prefers-color-scheme:dark){.header .main-menu .active{color:#f8f9fa;background:#212529}}@media (max-width:1199.98px) and (prefers-color-scheme:light){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list{background:#fff}}@media (max-width:1199.98px) and (prefers-color-scheme:dark){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list{background:#212529}}@media (max-width:1199.98px){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li .main-menu-dropdown-item-subtitle{text-indent:30px;margin-left:30px}}@media (max-width:1199.98px) and (prefers-color-scheme:light){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a{color:#212529}}@media (max-width:1199.98px) and (prefers-color-scheme:dark){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a{color:#f8f9fa}}@media (max-width:1199.98px) and (prefers-color-scheme:light){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li a{color:#212529}}@media (max-width:1199.98px) and (prefers-color-scheme:dark){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li a{color:#f8f9fa}}@media (max-width:1199.98px) and (prefers-color-scheme:light){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li a:hover{background:#fff}}@media (max-width:1199.98px) and (prefers-color-scheme:dark){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li a:hover{background:#212529}}@media (max-width:1199.98px){.header .main-menu li:active a,.header .main-menu li:hover a{border-left:3px solid #0084b4}.header .main-menu .main-menu-dropdown-list li{text-indent:15px}.header .main-menu .main-menu-dropdown-list li ul li{text-indent:30px}.header .main-menu .main-menu-dropdown-list li ul li ul li{text-indent:45px}.header .main-menu .main-menu-logo{display:none;padding:0;margin:0}.header .main-menu .notification-info .notification-qty{position:absolute;top:-3px;right:15px}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu{background:#fff;border-top:1px solid #fff;border-bottom:1px solid #fff}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu{background:#212529;border-top:1px solid #343a40;border-bottom:1px solid #212529}}@media (min-width:992px){.header .main-menu .logo{font-weight:400}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu li:not(:last-child){border-left:1px solid #fff;border-right:1px solid #fff}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu li:not(:last-child){border-left:1px solid #212529;border-right:1px solid #212529}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu a,.header .main-menu i{color:#212529}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu a,.header .main-menu i{color:#f8f9fa}}@media (min-width:992px){.header .main-menu .fa{margin-right:5px}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu .active,.header .main-menu .active>i{color:#fff;background:#0084b4}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu .active,.header .main-menu .active>i{color:#fff;background:#0084b4}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu .active>i i,.header .main-menu .active i{color:#fff}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu .active>i i,.header .main-menu .active i{color:#dee2e6}}@media (min-width:992px){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list{margin-top:-3px;border-top:3px solid #0084b4}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list{background:#fff}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list{background:#212529}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li i{color:#212529}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li i{color:#f8f9fa}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li a,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li i,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li i li a,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li i li i{color:#212529}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li a,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li i,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li i li a,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li i li i{color:#f8f9fa}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li a:hover,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li i:hover,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li i li a:hover,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li i li i:hover{background:#fff}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li a:hover,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li a li i:hover,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li i li a:hover,.header .main-menu .main-menu-dropdown .main-menu-dropdown-list li i li i:hover{background:#212529}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu li:active,.header .main-menu li:hover{color:#fff;background:#0084b4}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu li:active,.header .main-menu li:hover{color:#dee2e6;background:#0084b4}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu li:active a,.header .main-menu li:active i,.header .main-menu li:hover a,.header .main-menu li:hover i{color:#fff}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu li:active a,.header .main-menu li:active i,.header .main-menu li:hover a,.header .main-menu li:hover i{color:#dee2e6}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu li ul li:active,.header .main-menu li ul li:hover{background:#fff}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu li ul li:active,.header .main-menu li ul li:hover{background:#212529}}@media (min-width:992px) and (prefers-color-scheme:light){.header .main-menu li ul li:active a,.header .main-menu li ul li:active i,.header .main-menu li ul li:hover a,.header .main-menu li ul li:hover i{color:#fff}}@media (min-width:992px) and (prefers-color-scheme:dark){.header .main-menu li ul li:active a,.header .main-menu li ul li:active i,.header .main-menu li ul li:hover a,.header .main-menu li ul li:hover i{color:#dee2e6}}@media (min-width:992px){.header .main-menu .main-menu{display:block}.header .main-menu .main-menu-dropdown-item-subtitle{text-indent:10px;margin-left:0}.header #mobile-menu,.header .main-menu label.main-menu-dropdown-icon{display:none}.header .main-menu ul span.main-menu-dropdown-icon{display:inline-block}.header .main-menu li{float:left;border-width:0 1px 0 0}.header .main-menu .main-menu-dropdown-list{border-width:0;margin:0;position:absolute;top:100%;left:0;z-index:100;display:none;min-width:250px;box-shadow:0 .25rem 1rem rgba(0,0,0,.15)}.header .main-menu .main-menu-dropdown-list a{padding:10px 15px}.header .main-menu .main-menu-dropdown-list li{float:none;border-width:1px 0 0}.header .main-menu .main-menu-dropdown-list .main-menu-dropdown-list{top:0;left:100%}.header .main-menu .main-menu-dropdown-list .main-menu-dropdown-icon{position:absolute;top:0;right:0;padding:1em}.header .main-menu .main-menu-dropdown-list.main-menu-dropdown-shop{min-width:250px;right:100%;left:54px;transform:translate(-100%)}.header .main-menu .main-menu-dropdown-list.main-menu-dropdown-megamenu{min-width:800px;left:50%;transform:translate(-50%)}.header .main-menu input[type=checkbox]:checked+.main-menu-dropdown-list{display:none}.header .main-menu li:hover>input[type=checkbox]+.main-menu-dropdown-list{display:block}.header .main-menu .main-menu-shop{width:54px}.header .main-menu .main-menu-right{float:right}}.header .arrow-down:before,.header .arrow-right:before{content:"";border-style:solid;border-color:inherit;border-width:0 1px 1px 0;display:inline-block;padding:3px;position:absolute;top:50%}.header .arrow-down{padding-right:16px}.header .arrow-down:before{right:16px;transform:translate(-50%,-50%) rotate(45deg);margin-top:-1px}.header .arrow-right:before{right:16px;transform:rotate(-45deg);margin-top:2px}.header .main-menu .hamburger{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:20px;height:1px}@media (prefers-color-scheme:light){.header .main-menu .hamburger{background:#212529}}@media (prefers-color-scheme:dark){.header .main-menu .hamburger{background:#f8f9fa}}.header .main-menu .hamburger:after,.header .main-menu .hamburger:before{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:20px;height:1px}@media (prefers-color-scheme:light){.header .main-menu .hamburger:after,.header .main-menu .hamburger:before{background:#212529}}@media (prefers-color-scheme:dark){.header .main-menu .hamburger:after,.header .main-menu .hamburger:before{background:#f8f9fa}}.header .main-menu .hamburger:before{content:"";top:-5px}.header .main-menu .hamburger:after{content:"";top:7px}.tooltip{position:relative;cursor:pointer;z-index:1050}.tooltip:after{background-color:#000;border-radius:.25rem;color:#fff;content:attr(data-tooltip-title);font-weight:400;min-width:150px;padding:.5rem .75rem;text-align:center;text-transform:none;font-size:.75rem}.tooltip:disabled:after{content:attr(data-disabled-tooltip-title)}.tooltip:before{width:0;height:0;content:"";position:absolute;transition:opacity .3s ease 0ms,transform .3s ease 0ms;transform-style:preserve-3d;opacity:0;z-index:-1}.tooltip:after{position:absolute;transition:opacity .3s ease 0ms,transform .3s ease 0ms;transform-style:preserve-3d;opacity:0;z-index:-1}.tooltip[data-tooltip-position=top]:before{border-left:7px solid transparent;border-right:7px solid transparent;left:50%;transform:translate3d(-50%,10px,0);border-top:7px solid #000;bottom:calc(100% + 3px)}.tooltip[data-tooltip-position=top]:hover:before{transform:translate3d(-50%,0,0)}.tooltip[data-tooltip-position=top]:after{left:50%;transform:translate3d(-50%,10px,0);bottom:calc(100% + 10px)}.tooltip[data-tooltip-position=top]:hover:after{transform:translate3d(-50%,0,0)}.tooltip[data-tooltip-position=bottom]:before{border-left:7px solid transparent;border-right:7px solid transparent;left:50%;transform:translate3d(-50%,-10px,0);border-bottom:7px solid #000;top:calc(100% + 3px)}.tooltip[data-tooltip-position=bottom]:hover:before{transform:translate3d(-50%,0,0)}.tooltip[data-tooltip-position=bottom]:after{left:50%;transform:translate3d(-50%,-10px,0);top:calc(100% + 10px)}.tooltip[data-tooltip-position=bottom]:hover:after{transform:translate3d(-50%,0,0)}.tooltip[data-tooltip-position=left]:before{transform:translate3d(10px,-50%,0);border-left:7px solid #000;right:calc(100% + 3px);border-top:7px solid transparent;border-bottom:7px solid transparent;top:50%}.tooltip[data-tooltip-position=left]:hover:before{transform:translate3d(0,-50%,0)}.tooltip[data-tooltip-position=left]:after{top:50%;transform:translate3d(10px,-50%,0);right:calc(100% + 10px)}.tooltip[data-tooltip-position=left]:hover:after{transform:translate3d(0,-50%,0)}.tooltip[data-tooltip-position=right]:before{transform:translate3d(-10px,-50%,0);border-right:7px solid #000;left:calc(100% + 3px);border-top:7px solid transparent;border-bottom:7px solid transparent;top:50%}.tooltip[data-tooltip-position=right]:hover:before{transform:translate3d(0,-50%,0)}.tooltip[data-tooltip-position=right]:after{top:50%;transform:translate3d(-10px,-50%,0);left:calc(100% + 10px)}.tooltip[data-tooltip-position=right]:hover:after{transform:translate3d(0,-50%,0)}.tooltip:hover:after,.tooltip:hover:before{opacity:1;z-index:100}footer{min-height:220px;font-size:.875rem}@media (prefers-color-scheme:light){footer{color:#fff;background:#0084b4}}@media (prefers-color-scheme:dark){footer{color:#fff;background:#0084b4}}.bg-primary{background:#0084b4}a.bg-primary:focus,a.bg-primary:hover,button.bg-primary:focus,button.bg-primary:hover{background:#005f81}.bg-secondary{background:#6c757d}a.bg-secondary:focus,a.bg-secondary:hover,button.bg-secondary:focus,button.bg-secondary:hover{background:#545b62}.bg-success{background:#28a745}a.bg-success:focus,a.bg-success:hover,button.bg-success:focus,button.bg-success:hover{background:#1e7e34}.bg-info{background:#17a2b8}a.bg-info:focus,a.bg-info:hover,button.bg-info:focus,button.bg-info:hover{background:#117a8b}.bg-warning{background:beige}a.bg-warning:focus,a.bg-warning:hover,button.bg-warning:focus,button.bg-warning:hover{background:#eaeab4}.bg-danger{background:#dc3545}a.bg-danger:focus,a.bg-danger:hover,button.bg-danger:focus,button.bg-danger:hover{background:#bd2130}.bg-light{background:#dee2e6}a.bg-light:focus,a.bg-light:hover,button.bg-light:focus,button.bg-light:hover{background:#c1c9d0}.bg-dark{background:#212529}a.bg-dark:focus,a.bg-dark:hover,button.bg-dark:focus,button.bg-dark:hover{background:#0a0c0d}.clearfix:after{display:block;clear:both;content:""}@media (prefers-color-scheme:light){.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}}@media (prefers-color-scheme:dark){.hljs{display:block;overflow-x:auto;padding:.5em;color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}blockquote{padding:0 1em;color:#8b949e;border-left:.25em solid #3b434b}}@media (prefers-color-scheme:light){blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}}blockquote>:first-child{margin-top:0}blockquote>:last-child{margin-bottom:0}figure{margin:1em auto;text-align:center}figure figcaption{font-size:95%;opacity:.7;margin:0 auto 1.5em;text-align:center}figure figcaption a{text-decoration:underline}header{font-size:2em;text-align:center}.headerbar{background:inherit;height:50px;position:fixed;z-index:999;top:0;width:100%;display:flex;align-items:center}.site-name{margin:auto}.hamburger{padding-left:10px}.sidebar{padding:10px;margin:0}.sidebar>li{list-style:none;margin-bottom:10px}.sidebar a{text-decoration:none}.close-sidebar{font-size:1.5em;padding-left:5px}@media (min-width:576px){main{max-width:540px}}@media (min-width:768px){main{max-width:720px}}@media (min-width:992px){main{max-width:960px}}@media (min-width:1200px){main{max-width:1140px}}main{margin-top:50px;width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}.anchor{padding-right:.375em;text-decoration:none}[data-anchor-icon]:after{content:attr(data-anchor-icon)}amp-social-share[type=hatena_bookmark]{display:inline-block;position:relative;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 500'%3E%3Crect width='500' height='500' rx='101.9' ry='101.9' fill='%2300a4de'/%3E%3Cg fill='%23fff'%3E%3Cpath d='M278.2,258.1q-13.6-15.2-37.8-17c14.4-3.9,24.8-9.6,31.4-17.3s9.8-17.8,9.8-30.7A55,55,0,0,0,275,166a48.8,48.8,0,0,0-19.2-18.6c-7.3-4-16-6.9-26.2-8.6s-28.1-2.4-53.7-2.4H113.6V363.6h64.2q38.7,0,55.8-2.6c11.4-1.8,20.9-4.8,28.6-8.9a52.5,52.5,0,0,0,21.9-21.4c5.1-9.2,7.7-19.9,7.7-32.1C291.8,281.7,287.3,268.2,278.2,258.1Zm-107-71.4h13.3q23.1,0,31,5.2c5.3,3.5,7.9,9.5,7.9,18s-2.9,14-8.5,17.4-16.1,5-31.4,5H171.2V186.7Zm52.8,130.3c-6.1,3.7-16.5,5.5-31.1,5.5H171.2V273h22.6c15,0,25.4,1.9,30.9,5.7s8.4,10.4,8.4,20S230.1,313.4,223.9,317.1Z'/%3E%3Cpath d='M357.6,306.1a28.8,28.8,0,1,0,28.8,28.8A28.8,28.8,0,0,0,357.6,306.1Z'/%3E%3Crect x='332.6' y='136.4' width='50' height='151.52'/%3E%3C/g%3E%3C/svg%3E")}amp-social-share[type=rss]{display:inline-block;position:relative;background-color:#ff9800;background-image:url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 24 24"><path fill="%23FFFFFF" d="M6.18,15.64A2.18,2.18 0 0,1 8.36,17.82C8.36,19 7.38,20 6.18,20C5,20 4,19 4,17.82A2.18,2.18 0 0,1 6.18,15.64M4,4.44A15.56,15.56 0 0,1 19.56,20H16.73A12.73,12.73 0 0,0 4,7.27V4.44M4,10.1A9.9,9.9 0 0,1 13.9,20H11.07A7.07,7.07 0 0,0 4,12.93V10.1Z" /></svg>')}footer a{text-decoration:none}footer a:hover{text-decoration:none;opacity:.7}.purchases-items [role=list]{display:flex;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.table-of-contents{padding:1em 1em 1em 2em;margin:1em 0;border:1px solid}[class*=" devicon-"],[class^=devicon-]{font-size:4.78em}</style><link rel="manifest" href="https://silver-birder.github.io/manifest.json"><link rel="alternate" type="application/rss+xml" href="https://silver-birder.github.io/blog/feed.xml" title="RSS2.0"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Webpage","url":"https://silver-birder.github.io/blog/contents/intro_to_LLVM-JIT_compilation_of_javascript_with_LLVM_Rust_inkwell","name":"Silverbirder's portfolio","headline":"Show my portfolio","description":"My contents is self intro, blog, projects, and books.","mainEntityOfPage":{"@type":"WebPage","@id":"https://silver-birder.github.io"},"publisher":{"@type":"Person","name":"silverbirder","image":"https://res.cloudinary.com/silverbirder/image/upload/c_scale,w_520/v1611128736/silver-birder.github.io/assets/logo.png"}}</script><title>LLVM入門 - javascriptをLLVM(Rust:inkwell)でJITコンパイルするまで - silverbirder</title><link data-auto rel="canonical" href="https://silver-birder.github.io/blog/contents/intro_to_LLVM-JIT_compilation_of_javascript_with_LLVM_Rust_inkwell"></head><body>
<header class="headerbar"> <div role="button" on="tap:sidebar.toggle" tabindex="0" class="hamburger">☰</div> <div class="site-name"></div>
</header>
<amp-sidebar id="sidebar" layout="nodisplay" side="left" class="i-amphtml-layout-nodisplay" hidden="hidden" i-amphtml-layout="nodisplay"> <div role="button" aria-label="close sidebar" on="tap:sidebar.toggle" tabindex="0" class="close-sidebar">✕</div> <nav> <ul class="sidebar"> <li><a href="https://silver-birder.github.io/">Top</a></li> <li><a href="https://silver-birder.github.io/blog">Blog</a></li> <li><a href="https://silver-birder.github.io/books">Books</a></li> <li><a href="https://silver-birder.github.io/projects">Projects</a></li> <li><a href="https://silver-birder.github.io/purchases">Purchases</a></li> <li><a href="https://silver-birder.github.io/watches">Watches</a></li> </ul> </nav> </amp-sidebar>
<main>
<p>コンパイラ基盤であるLLVMについて、全く知識がない私が、
javascriptソースコードをパースしLLVMでコンパイルできるようになりました。</p>
<p>LLVMの記事は数多くありますが、初心者向けの記事が少なく感じたため、
本記事では、できる限り分かりやすくLLVMについて紹介できる記事を書こうと思います。</p>
<p></p><div class="table-of-contents"><ul><li><a href="#自己紹介">自己紹介</a></li><li><a href="#背景">背景</a></li><li><a href="#コンパイラとは">コンパイラとは</a></li><li><a href="#llvmとは">LLVMとは</a></li><li><a href="#llvm開発で、知っておくべきこと">LLVM開発で、知っておくべきこと</a><ul><li><a href="#module">Module</a></li><li><a href="#function">Function</a></li><li><a href="#block">Block</a></li><li><a href="#instruction">Instruction</a></li><li><a href="#参考資料">参考資料</a></li></ul></li><li><a href="#llvmをやってみよう">LLVMをやってみよう</a><ul><li><a href="#開発環境">開発環境</a></li><li><a href="#&quot;hello_world&quot;_を出力">"Hello World" を出力</a></li><li><a href="#sum">SUM</a></li><li><a href="#fizzbuzz">FizzBuzz</a></li><li><a href="#四則演算するjavascriptをパース">四則演算するJavascriptをパース</a></li><li><a href="#四則演算するjavascriptをllvmで実行">四則演算するJavascriptをLLVMで実行</a></li></ul></li><li><a href="#終わりに">終わりに</a></li></ul></div><p></p>
<h1 id="自己紹介"><a class="anchor" aria-label="Anchor" data-anchor-icon="#" href="#自己紹介"></a>自己紹介</h1>
<p>ふだん、javascriptやpythonなどインタプリタ言語を使うエンジニアです。
LLVMについて、全く知識がなかった人間です。</p>
<h1 id="背景"><a class="anchor" aria-label="Anchor" data-anchor-icon="#" href="#背景"></a>背景</h1>
<p>過去に、おもちゃのブラウザ自作をやってみました。(<a href="https://silver-birder.github.io/blog/contents/learning_browser_engine">ブラウザの仕組みを学ぶ</a>)
HTMLとCSSを解析し、レンダリングするところを書き、基本的な動作を知ることができました。
HTMLとCSSとくれば、次はJSだと思い、JSを実行するエンジンを書いてみたくなりました。
ただし、WebブラウザのAPIとJS実行エンジンをバインディングする箇所(EX.DOM操作)は難しいので、
まずは、単純な処理、四則演算やfizzbuzzが処理できるものを作ろうと思いました。</p>
<h1 id="コンパイラとは"><a class="anchor" aria-label="Anchor" data-anchor-icon="#" href="#コンパイラとは"></a>コンパイラとは</h1>
<p>コンパイラとは、</p>
<blockquote>
<p>compiler is a computer program that translates computer code written in one programming language (the source language) into another language (the target language). The name "compiler" is primarily used for programs that translate source code from a high-level programming language to a lower level language (e.g. assembly language, object code, or machine code) to create an executable program.</p>
</blockquote>
<p>※ <a href="https://en.wikipedia.org/wiki/Compiler">https://en.wikipedia.org/wiki/Compiler</a></p>
<p>に書かれている通り、あるコードを別のコードに変換するプログラムのことをコンパイラと指します。
主に、高級言語(ex. javascript)から低級言語(ex. アセンブリ言語)への変換という意味でコンパイラが使われます。</p>
<hr>
<p>プログラムをコンパイルするというのは、主に次の順番で処理されます。</p>
<amp-img src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuIfAJIv9p4lFILLutBJtSVEUnqqx7pTj1Z6QEv4adwwT_hH_wOlbYv_Dcu0a_6nvzxDfxJY4dyrPWIJsPCVQbzCclrZHy6BLF1HRePOzdpB_MSS4BYvCPoZesg7QZym1IQAu0fc3a0Iv1Su22QCu1va3aaHtb4DgNWemi000" alt="uml diagram" width="678" height="55" layout="intrinsic" i-amphtml-ssr data-hero class="i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjU1IiB3aWR0aD0iNjc4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIvPg=="></i-amphtml-sizer><img class="i-amphtml-fill-content i-amphtml-replaced-content" decoding="async" alt="uml diagram" src="https://www.plantuml.com/plantuml/svg/SoWkIImgAStDuIfAJIv9p4lFILLutBJtSVEUnqqx7pTj1Z6QEv4adwwT_hH_wOlbYv_Dcu0a_6nvzxDfxJY4dyrPWIJsPCVQbzCclrZHy6BLF1HRePOzdpB_MSS4BYvCPoZesg7QZym1IQAu0fc3a0Iv1Su22QCu1va3aaHtb4DgNWemi000"></amp-img>
<hr>
<p>字句解析 ~ 構文木は、lexやyaccというソフトウェアが有名だと思います。
今回は、swc_ecma_parserというものを使います。swc_ecma_parserは、<a href="https://github.com/swc-project/swc">swc</a>で使われるパーサです。</p>
<blockquote>
<p>EcmaScript/TypeScript parser for the rust programming language.
Passes almost all tests from tc39/test262.</p>
</blockquote>
<p>※ <a href="https://rustdoc.swc.rs/swc_ecma_parser/">swc_ecma_parser</a></p>
<p>tc39/test262のテストケースをほとんどパスしているようです。
<a href="https://github.com/tc39/test262">tc39/test262</a>は、次の仕様動作を保証するテストスイートです。</p>
<pre><code class="hljs apache"><span class="hljs-attribute">ECMA</span>-<span class="hljs-number">262</span>, ECMAScript Language Specification
<span class="hljs-attribute">ECMA</span>-<span class="hljs-number">402</span>, ECMAScript Internationalization API Specification
<span class="hljs-attribute">ECMA</span>-<span class="hljs-number">404</span>, The JSON Data Interchange Format (pdf)
</code></pre>
<p>実際のテストコードは、<a href="https://github.com/tc39/test262/tree/main/test">tc39/test262/test</a>にあります。</p>
<hr>
<p>パーサ部分を自作しようか悩みました。
自作するには、次の手順を踏むことになります。</p>
<ol>
<li>言語文法の理解</li>
<li>パース処理の実装</li>
<li>BNFやPEGからパース自動生成も可</li>
</ol>
<p>①番の言語文法について知るために、ecmascriptのBNFってどれだろうなと調べていました。
そうすると、私の調べた範囲では、次のページにたどり着きました。</p>
<p><a href="https://tc39.es/ecma262/#sec-grammar-summary">https://tc39.es/ecma262/#sec-grammar-summary</a></p>
<p>これは、先程の<a href="https://rustdoc.swc.rs/swc_ecma_parser/">swc_ecma_parser</a>のテストスイート対象<a href="https://github.com/tc39/test262/tree/main/test">tc39/test262/test</a>であったので、あえて再構築する気になれず、自作は諦めました。</p>
<hr>
<p>中間言語 ~ コード生成については、LLVMというコンパイル基盤を使おうと思います。</p>
<h1 id="llvmとは"><a class="anchor" aria-label="Anchor" data-anchor-icon="#" href="#llvmとは"></a>LLVMとは</h1>
<p>LLVMとは、公式ページより、</p>
<blockquote>
<p>The LLVM Project is a collection of modular and reusable compiler and toolchain technologies.</p>
</blockquote>
<p>※ <a href="https://llvm.org/">ttps://llvm.org/</a></p>
<p>LLVMプロジェクトとは、再利用性が高いコンパイラとツールチェイン技術の総称です。
LLVMは、次の特徴があります。</p>
<blockquote>
<p>LLVM is a set of compiler and toolchain technologies, which can be used to develop a front end for any programming language and a back end for any instruction set architecture. LLVM is designed around a language-independent intermediate representation (IR) that serves as a portable, high-level assembly language that can be optimized with a variety of transformations over multiple passes.</p>
</blockquote>
<p>※ <a href="https://en.wikipedia.org/wiki/LLVM">https://en.wikipedia.org/wiki/LLVM</a></p>
<p>LLVMは、任意のフロントエンド言語(コンパイラという文脈でいう変換前の言語)から任意の命令セットアーキテクチャ(以下、ISA)バックエンドへ変換できます。
また、非言語依存な中間言語(以下、IR)を中心として設計されています。</p>
<figure title="Retargetablity - The Architecture of Open Source Applications: LLVM">
<amp-img alt="Retargetablity - The Architecture of Open Source Applications: LLVM" src="http://www.aosabook.org/images/llvm/RetargetableCompiler.png" width="557" height="206" layout="intrinsic" class="i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjIwNiIgd2lkdGg9IjU1NyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="></i-amphtml-sizer></amp-img>
<figcaption>Retargetablity - The Architecture of Open Source Applications: LLVM<figcaption>
</figcaption></figcaption></figure> <hr>
<p>命令セットアーキテクチャは、次の意味になります。</p>
<blockquote>
<p>命令セットとは、あるマイクロプロセッサ（CPU/MPU）を動作させるための命令語の体系。プロセッサが直に解釈して実行できる機械語（マシン語）の仕様を定めたもの。</p>
</blockquote>
<p>※ <a href="https://e-words.jp/w/%E5%91%BD%E4%BB%A4%E3%82%BB%E3%83%83%E3%83%88.html">https://e-words.jp/w/命令セット.html</a></p>
<p>プロセッサを動作させるための命令は、例えばLoad(LDR)とStore(STR)です。Loadは、メモリからレジスタへセットし、Storeは、その逆です。
後で紹介する<a href="https://thedan64.github.io/inkwell/inkwell/builder/struct.Builder.html">Instruction(Builder)</a>に一覧があります。</p>
<hr>
<p>今回、LLVMのフロントエンド言語は、タイトルにある通り、Rustで書こうと思います。
単にRustでやってみたかっただけです。
LLVMライブラリとして、<a href="https://github.com/TheDan64/inkwell">inkwell</a>を使用します。
これは、LLVMのC APIを安全に使えるようにする薄いラッパーライブラリです。</p>
<hr>
<p>LLVMのバックエンドは、ローカルマシンで動かすこととします。
具体的には、<code>x86_64-apple-darwin20.6.0</code> になります。</p>
<p>試していないですが、WASMもバックエンドとして選択できるようです。
というのも、過去の記事(<a href="https://www.publickey1.jp/blog/19/webassemblyllvm_80.html">WebAssemblyに正式対応した「LLVM 8.0」がリリース － Publickey</a>)ですが、LLVMがバックエンドとしてWebAssembly(以下,WASM)をサポートしました。</p>
<ul>
<li><a href="https://thedan64.github.io/inkwell/inkwell/targets/struct.Target.html#method.initialize_webassembly">Target initialize_webassembly</a></li>
</ul>
<p>ちなみに、WASMは、仮想的なISAとして設計されています。</p>
<blockquote>
<p>WebAssembly, or "wasm", is a general-purpose virtual ISA designed to be a compilation target for a wide variety of programming languages.</p>
</blockquote>
<p><a href="https://github.com/sunfishcode/wasm-reference-manual/blob/master/WebAssembly.md">WebAssembly Reference Manual</a></p>
<h1 id="llvm開発で、知っておくべきこと"><a class="anchor" aria-label="Anchor" data-anchor-icon="#" href="#llvm開発で、知っておくべきこと"></a>LLVM開発で、知っておくべきこと</h1>
<p>LLVMでは、IRを生成します。
そのIRでは、<code>Module ⊇ Function ⊇ Block ⊇ Instruction(Builder)</code> という構成になっています。
これを知っていないと、LLVMのコードを見ても、理解しにくいと思います。(自身が持つ言葉で解釈して誤った理解になりかねません)</p>
<p>小さなC言語コードとIRで例を示します。
Rustじゃなく、Cを選んだのは、clangから手軽にIRを出力できるからです。</p>
<pre><code class="language-c hljs c"><span class="hljs-comment">// if.c</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
    <span class="hljs-keyword">int</span> i = rand();
    <span class="hljs-keyword">if</span> (i == <span class="hljs-number">1</span>)
    {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"i is one."</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>これをIRに変換</p>
<pre><code class="language-shell hljs"><span class="hljs-meta">$</span><span class="bash"> clang -S -emit-llvm -O3 if.c</span>
</code></pre>
<p>出力されたファイルは、<code>if.ll</code>というIRファイルです。
そこから、<code>@main</code>コードを見ます。</p>
<pre><code class="hljs llvm"><span class="hljs-title">@.str</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">unnamed_addr</span> <span class="hljs-keyword">constant</span> [<span class="hljs-number">10</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>] <span class="hljs-keyword">c</span><span class="hljs-string">"i is one.\00"</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">align</span> <span class="hljs-number">1</span>

<span class="hljs-keyword">define</span> <span class="hljs-type">i32</span> <span class="hljs-title">@main</span>() local_unnamed_addr <span class="hljs-variable">#0</span> {
  <span class="hljs-variable">%1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">tail</span> <span class="hljs-keyword">call</span> <span class="hljs-type">i32</span> <span class="hljs-title">@rand</span>() <span class="hljs-variable">#3</span>
  <span class="hljs-variable">%2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">icmp</span> <span class="hljs-keyword">eq</span> <span class="hljs-type">i32</span> <span class="hljs-variable">%1</span><span class="hljs-punctuation">,</span> <span class="hljs-number">1</span>
  <span class="hljs-keyword">br</span> <span class="hljs-type">i1</span> <span class="hljs-variable">%2</span><span class="hljs-punctuation">,</span> label <span class="hljs-variable">%3</span><span class="hljs-punctuation">,</span> label <span class="hljs-variable">%5</span>

<span class="hljs-number">3</span>:                                                <span class="hljs-comment">; preds = %0</span>
  <span class="hljs-variable">%4</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">tail</span> <span class="hljs-keyword">call</span> <span class="hljs-type">i32</span> (<span class="hljs-type">i8</span>*<span class="hljs-punctuation">,</span> ...) <span class="hljs-title">@printf</span>(<span class="hljs-type">i8</span>* nonnull dereferenceable(<span class="hljs-number">1</span>) <span class="hljs-keyword">getelementptr</span> <span class="hljs-keyword">inbounds</span> ([<span class="hljs-number">10</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]<span class="hljs-punctuation">,</span> [<span class="hljs-number">10</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]* <span class="hljs-title">@.str</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i64</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i64</span> <span class="hljs-number">0</span>))
  <span class="hljs-keyword">br</span> label <span class="hljs-variable">%5</span>

<span class="hljs-number">5</span>:                                                <span class="hljs-comment">; preds = %3, %0</span>
  <span class="hljs-keyword">ret</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span>
}

<span class="hljs-keyword">declare</span> <span class="hljs-type">i32</span> <span class="hljs-title">@rand</span>() local_unnamed_addr <span class="hljs-variable">#1</span>

<span class="hljs-keyword">declare</span> noundef <span class="hljs-type">i32</span> <span class="hljs-title">@printf</span>(<span class="hljs-type">i8</span>* <span class="hljs-keyword">nocapture</span> noundef <span class="hljs-keyword">readonly</span><span class="hljs-punctuation">,</span> ...) local_unnamed_addr <span class="hljs-variable">#2</span>
</code></pre>
<p>IRをModule,Function,Block,Instructionで区切って見ると、次の画像のとおりです。</p>
<p><amp-img src="https://res.cloudinary.com/silverbirder/image/upload/v1633770792/silver-birder.github.io/blog/sample_llvm_code.png" alt="sample_llvm_code" width="2068" height="1138" layout="intrinsic" class="i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjExMzgiIHdpZHRoPSIyMDY4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIvPg=="></i-amphtml-sizer></amp-img></p>
<p>それぞれ、どういうものか簡単に説明します。</p>
<h2 id="module"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#module"></a>Module</h2>
<blockquote>
<p>LLVM programs are composed of Module’s, each of which is a translation unit of the input programs.</p>
</blockquote>
<p>※ <a href="https://llvm.org/docs/LangRef.html#module-structure">https://llvm.org/docs/LangRef.html#module-structure</a></p>
<p>モジュールは、入力プログラムの変換単位になります。
モジュールには、関数、グローバル変数、シンボルテーブルエントリを持ちます。</p>
<h2 id="function"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#function"></a>Function</h2>
<blockquote>
<p>LLVM function definitions consist of the “define” keyword.
A function definition contains a list of basic blocks.</p>
</blockquote>
<p>※ <a href="https://llvm.org/docs/LangRef.html#functions">https://llvm.org/docs/LangRef.html#functions</a></p>
<p>関数は、複数のブロック(Block)を持ちます。</p>
<h2 id="block"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#block"></a>Block</h2>
<blockquote>
<p>Each basic block may optionally start with a label (giving the basic block a symbol table entry), contains a list of instructions, and ends with a terminator instruction (such as a branch or function return).</p>
</blockquote>
<p>※ <a href="https://llvm.org/docs/LangRef.html#functions">https://llvm.org/docs/LangRef.html#functions</a></p>
<p>ブロックは、ラベルから始まり、複数の命令(Instruction)を持ちます。</p>
<h2 id="instruction"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#instruction"></a>Instruction</h2>
<blockquote>
<p>The LLVM instruction set consists of several different classifications of instructions: terminator instructions, binary instructions, bitwise binary instructions, memory instructions, and other instructions.</p>
</blockquote>
<p>※ <a href="https://llvm.org/docs/LangRef.html#instruction-reference">https://llvm.org/docs/LangRef.html#instruction-reference</a></p>
<p>命令は、バイナリ命令やメモリ命令など、様々な命令があります。</p>
<h2 id="参考資料"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#参考資料"></a>参考資料</h2>
<p>参考になる資料たちは、次のとおりです。</p>
<ul>
<li>チュートリアル
<ul>
<li>C++ <a href="https://llvm.org/docs/tutorial/">Kaleidoscope</a></li>
<li>Rust <a href="https://github.com/jauhien/iron-kaleidoscope">Kaleidoscope</a>
<ul>
<li>codegenが動かないため、途中までしか使えません</li>
</ul>
</li>
<li>Rust + inkwell <a href="https://github.com/TheDan64/inkwell/blob/master/examples/kaleidoscope">Kaleidoscope</a></li>
</ul>
</li>
<li>LLVMリファレンス
<ul>
<li><a href="https://llvm.org/docs/LangRef.html">LLVM Language Reference Manual</a></li>
</ul>
</li>
</ul>
<h1 id="llvmをやってみよう"><a class="anchor" aria-label="Anchor" data-anchor-icon="#" href="#llvmをやってみよう"></a>LLVMをやってみよう</h1>
<p>前置きが長くなりましたが、実際にLLVMをやっていきたいと思います。</p>
<h2 id="開発環境"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#開発環境"></a>開発環境</h2>
<p>私の環境(Mac)はこちらです。</p>
<pre><code class="language-shell hljs"><span class="hljs-meta">$</span><span class="bash"> sw_vers</span> 
ProductName:    macOS
ProductVersion: 11.6
BuildVersion:   20G165
<span class="hljs-meta">$</span><span class="bash"> cargo --version &amp;&amp; rustc --version</span>
cargo 1.56.0-nightly (18751dd3f 2021-09-01)
rustc 1.56.0-nightly (50171c310 2021-09-01)
</code></pre>
<p>llvmのインストールは、Macユーザなので、<a href="https://formulae.brew.sh/formula/llvm">brewからllvm</a>をインストールします。
<a href="https://releases.llvm.org/download.html">公式ページからダウンロード</a>もできるようです。</p>
<p>インストールが完了すると、clangやllcといったツールが使えます。</p>
<pre><code class="language-shell hljs"><span class="hljs-meta">$</span><span class="bash"> clang --version</span>
Homebrew clang version 13.0.0
Target: x86_64-apple-darwin20.6.0
Thread model: posix
InstalledDir: /usr/local/opt/llvm/bin
<span class="hljs-meta">$</span><span class="bash"> llc -version</span>
Homebrew LLVM version 12.0.1
</code></pre>
<p>MacにはXcodeにclangが含まれているようです。こちらを使っても問題ありません。
(ただ、xcodeのclangには、<a href="https://github.com/WebAssembly/wasi-sdk/issues/172#issuecomment-772399153">wasmには対応していないです</a>)</p>
<pre><code class="language-shell hljs"><span class="hljs-meta">#</span><span class="bash"> xcode付属のclangの場合</span>
<span class="hljs-meta">$</span><span class="bash"> clang --version</span>
Apple clang version 12.0.5 (clang-1205.0.22.9)
Target: x86_64-apple-darwin20.6.0
Thread model: posix
InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin
</code></pre>
<p>Cargo.tomlの<code>dependencies</code>は、次のとおりです。</p>
<pre><code class="language-toml hljs ini"><span class="hljs-section">[dependencies]</span>
<span class="hljs-attr">inkwell</span> = { git = <span class="hljs-string">"https://github.com/TheDan64/inkwell"</span>, branch = <span class="hljs-string">"master"</span>, features = [<span class="hljs-string">"llvm12-0"</span>] }
<span class="hljs-attr">swc_ecma_parser</span> = <span class="hljs-string">"0.73.0"</span>
<span class="hljs-attr">swc_common</span> = { version = <span class="hljs-string">"0.13.0"</span>, features=[<span class="hljs-string">"tty-emitter"</span>] }
<span class="hljs-attr">swc_ecma_ast</span> = <span class="hljs-string">"0.54.0"</span>
</code></pre>
<h2 id="&quot;hello_world&quot;_を出力"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#" hello_world"_を出力"></a>"Hello World" を出力</h2>
<p>まずは、Hello World を出力します。
Rustのコードは、次のものになります。</p>
<pre><code class="language-rust hljs"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> inkwell;

<span class="hljs-keyword">use</span> inkwell::context::Context;
<span class="hljs-keyword">use</span> inkwell::OptimizationLevel;

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
    <span class="hljs-keyword">let</span> context = Context::create();
    <span class="hljs-keyword">let</span> i32_type = context.i32_type();
    <span class="hljs-keyword">let</span> i8_type = context.i8_type();
    <span class="hljs-keyword">let</span> i8_ptr_type = i8_type.ptr_type(inkwell::AddressSpace::Generic);

    <span class="hljs-comment">// Module</span>
    <span class="hljs-keyword">let</span> module = context.create_module(<span class="hljs-string">"main"</span>);

    <span class="hljs-comment">// Function</span>
    <span class="hljs-keyword">let</span> printf_fn_type = i32_type.fn_type(&amp;[i8_ptr_type.into()], <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">let</span> printf_function = module.add_function(<span class="hljs-string">"printf"</span>, printf_fn_type, <span class="hljs-literal">None</span>);
    <span class="hljs-keyword">let</span> main_fn_type = i32_type.fn_type(&amp;[], <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">let</span> main_function = module.add_function(<span class="hljs-string">"main"</span>, main_fn_type, <span class="hljs-literal">None</span>);

    <span class="hljs-comment">// Block</span>
    <span class="hljs-keyword">let</span> entry_basic_block = context.append_basic_block(main_function, <span class="hljs-string">"entry"</span>);

    <span class="hljs-comment">// Instruction(Builder)</span>
    <span class="hljs-keyword">let</span> builder = context.create_builder();
    builder.position_at_end(entry_basic_block);
    <span class="hljs-keyword">let</span> hw_string_ptr = builder.build_global_string_ptr(<span class="hljs-string">"Hello, world!\n"</span>, <span class="hljs-string">"hw"</span>);
    builder.build_call(printf_function, &amp;[hw_string_ptr.as_pointer_value().into()], <span class="hljs-string">"call"</span>);
    builder.build_return(<span class="hljs-literal">Some</span>(&amp;i32_type.const_int(<span class="hljs-number">0</span>, <span class="hljs-literal">false</span>)));

    <span class="hljs-keyword">let</span> execution_engine = module.create_jit_execution_engine(OptimizationLevel::Aggressive).unwrap();
    <span class="hljs-keyword">unsafe</span> {
        execution_engine.get_function::&lt;<span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function"><span class="hljs-keyword">fn</span></span>()&gt;(<span class="hljs-string">"main"</span>).unwrap().call();
    }
}
</code></pre>
<p>実行してみます。</p>
<pre><code class="language-shell hljs"><span class="hljs-meta">$</span><span class="bash"> cargo run</span>
Hello, world!
</code></pre>
<p>LLVMのJITコンパイラで実行できました。
ちなみに、IRがどんなものか確認したい場合は、<code>module.print_to_file</code> を使いましょう。
実際に出力してみると、次の結果になります。</p>
<pre><code class="hljs llvm"><span class="hljs-comment">; ModuleID = 'main'</span>
source_filename <span class="hljs-operator">=</span> <span class="hljs-string">"main"</span>

<span class="hljs-title">@hw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">unnamed_addr</span> <span class="hljs-keyword">constant</span> [<span class="hljs-number">15</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>] <span class="hljs-keyword">c</span><span class="hljs-string">"Hello, world!\0A\00"</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">align</span> <span class="hljs-number">1</span>

<span class="hljs-keyword">declare</span> <span class="hljs-type">i32</span> <span class="hljs-title">@printf</span>(<span class="hljs-type">i8</span>*<span class="hljs-punctuation">,</span> ...)

<span class="hljs-keyword">define</span> <span class="hljs-type">i32</span> <span class="hljs-title">@main</span>() {
<span class="hljs-symbol">entry:</span>
  <span class="hljs-variable">%call</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">call</span> <span class="hljs-type">i32</span> (<span class="hljs-type">i8</span>*<span class="hljs-punctuation">,</span> ...) <span class="hljs-title">@printf</span>(<span class="hljs-type">i8</span>* <span class="hljs-keyword">getelementptr</span> <span class="hljs-keyword">inbounds</span> ([<span class="hljs-number">15</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]<span class="hljs-punctuation">,</span> [<span class="hljs-number">15</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]* <span class="hljs-title">@hw</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span>))
  <span class="hljs-keyword">ret</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span>
}
</code></pre>
<p>Rustの<code>execution_engine.get_function::&lt;unsafe extern "C" fn()&gt;("main").unwrap().call();</code>は、IRの<code>@main</code>関数を実行しています。
<code>@main</code>関数では、<code>@printf</code>関数を実行していますが、それは、C言語の<code>printf</code>になります。</p>
<p>IRのコードに関する調査は、<a href="https://llvm.org/docs/LangRef.html">LLVM Language Reference Manual</a> が重宝します。
<code>getelementptr</code>を調査してみると面白いです。</p>
<h2 id="sum"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#sum"></a>SUM</h2>
<p>次は、3つの数値を引数とし、足し算した結果を返す関数SUMを作成してみます。
Rustのコードは、次のものになります。</p>
<pre><code class="language-rust hljs"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> inkwell;

<span class="hljs-keyword">use</span> inkwell::OptimizationLevel;
<span class="hljs-keyword">use</span> inkwell::context::Context;
<span class="hljs-keyword">use</span> std::error::Error;

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() -&gt; <span class="hljs-built_in">Result</span>&lt;(), <span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
    <span class="hljs-keyword">let</span> context = Context::create();
    <span class="hljs-keyword">let</span> i64_type = context.i64_type();
    <span class="hljs-keyword">let</span> fn_type = i64_type.fn_type(&amp;[i64_type.into(), i64_type.into(), i64_type.into()], <span class="hljs-literal">false</span>);

    <span class="hljs-comment">// Module</span>
    <span class="hljs-keyword">let</span> module = context.create_module(<span class="hljs-string">"main"</span>);
    <span class="hljs-keyword">let</span> builder = context.create_builder();

    <span class="hljs-comment">// Function</span>
    <span class="hljs-keyword">let</span> function = module.add_function(<span class="hljs-string">"sum"</span>, fn_type, <span class="hljs-literal">None</span>);

    <span class="hljs-comment">// Block</span>
    <span class="hljs-keyword">let</span> basic_block = context.append_basic_block(function, <span class="hljs-string">"entry"</span>);

    <span class="hljs-comment">// Instruction(Builder)</span>
    builder.position_at_end(basic_block);
    <span class="hljs-keyword">let</span> x = function.get_nth_param(<span class="hljs-number">0</span>).unwrap().into_int_value();
    <span class="hljs-keyword">let</span> y = function.get_nth_param(<span class="hljs-number">1</span>).unwrap().into_int_value();
    <span class="hljs-keyword">let</span> z = function.get_nth_param(<span class="hljs-number">2</span>).unwrap().into_int_value();
    <span class="hljs-keyword">let</span> sum = builder.build_int_add(x, y, <span class="hljs-string">"sum"</span>);
    <span class="hljs-keyword">let</span> sum = builder.build_int_add(z, sum, <span class="hljs-string">"sum"</span>);
    builder.build_return(<span class="hljs-literal">Some</span>(&amp;sum));

    <span class="hljs-keyword">let</span> execution_engine = module.create_jit_execution_engine(OptimizationLevel::<span class="hljs-literal">None</span>)?;

    <span class="hljs-keyword">unsafe</span> { 
        <span class="hljs-keyword">let</span> x = <span class="hljs-number">1u64</span>;
        <span class="hljs-keyword">let</span> y = <span class="hljs-number">2u64</span>;
        <span class="hljs-keyword">let</span> z = <span class="hljs-number">3u64</span>;
        <span class="hljs-keyword">let</span> r = execution_engine.get_function::&lt;<span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function"><span class="hljs-keyword">fn</span></span>(<span class="hljs-built_in">u64</span>, <span class="hljs-built_in">u64</span>, <span class="hljs-built_in">u64</span>)-&gt; <span class="hljs-built_in">u64</span>&gt;(<span class="hljs-string">"sum"</span>)?.call(x, y , z);
        <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{:?}"</span>, r);
    };
    <span class="hljs-literal">Ok</span>(())
}
</code></pre>
<p>実行してみます。</p>
<pre><code class="language-shell hljs"><span class="hljs-meta">$</span><span class="bash"> cargo run</span>
6
</code></pre>
<p>見事、<code>1 + 2 + 3</code>の足し算ができました。
ちなみに、IRも出力しておきます。</p>
<pre><code class="hljs llvm"><span class="hljs-comment">; ModuleID = 'main'</span>
source_filename <span class="hljs-operator">=</span> <span class="hljs-string">"main"</span>
<span class="hljs-keyword">target</span> <span class="hljs-keyword">datalayout</span> <span class="hljs-operator">=</span> <span class="hljs-string">"e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128"</span>

<span class="hljs-keyword">define</span> <span class="hljs-type">i64</span> <span class="hljs-title">@sum</span>(<span class="hljs-type">i64</span> <span class="hljs-variable">%0</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%1</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%2</span>) {
<span class="hljs-symbol">entry:</span>
  <span class="hljs-variable">%sum</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">add</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%0</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%1</span>
  <span class="hljs-variable">%sum1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">add</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%2</span><span class="hljs-punctuation">,</span> <span class="hljs-variable">%sum</span>
  <span class="hljs-keyword">ret</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%sum1</span>
}
</code></pre>
<p>前回同様、Rustの<code>execution_engine.get_function::&lt;unsafe extern "C" fn(u64, u64, u64)-&gt; u64&gt;("sum")?.call(x, y , z);</code>は、IRの<code>@sum</code>関数に該当します。
足し算の<code>Instruction</code>が使えました。</p>
<h2 id="fizzbuzz"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#fizzbuzz"></a>FizzBuzz</h2>
<p>では、次はFizzBuzzをしてみます。割り算やifの命令が新しく使います。
Rustのコードは、次のものになります。</p>
<pre><code class="language-rust hljs"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> inkwell;

<span class="hljs-keyword">use</span> inkwell::context::Context;
<span class="hljs-keyword">use</span> inkwell::IntPredicate::EQ;
<span class="hljs-keyword">use</span> inkwell::OptimizationLevel;
<span class="hljs-keyword">use</span> std::error::Error;

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() -&gt; <span class="hljs-built_in">Result</span>&lt;(), <span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
    <span class="hljs-keyword">let</span> context = Context::create();
    <span class="hljs-keyword">let</span> i64_type = context.i64_type();
    <span class="hljs-keyword">let</span> void_type = context.void_type();
    <span class="hljs-keyword">let</span> i8_type = context.i8_type();

    <span class="hljs-keyword">let</span> i8_ptr_type = i8_type.ptr_type(inkwell::AddressSpace::Generic);
    <span class="hljs-keyword">let</span> fn_type = i64_type.fn_type(&amp;[i64_type.into()], <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">let</span> null = i8_ptr_type.const_null();

    <span class="hljs-comment">// Module</span>
    <span class="hljs-keyword">let</span> module = context.create_module(<span class="hljs-string">"fizz_buzz"</span>);

    <span class="hljs-comment">// Function</span>
    <span class="hljs-keyword">let</span> printf_fn_type = void_type.fn_type(&amp;[i8_ptr_type.into()], <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">let</span> printf_function = module.add_function(<span class="hljs-string">"printf"</span>, printf_fn_type, <span class="hljs-literal">None</span>);
    <span class="hljs-keyword">let</span> fizz_buzz_function = module.add_function(<span class="hljs-string">"fizz_buzz"</span>, fn_type, <span class="hljs-literal">None</span>);

    <span class="hljs-comment">// Block</span>
    <span class="hljs-keyword">let</span> block = context.append_basic_block(fizz_buzz_function, <span class="hljs-string">"entry"</span>);

    <span class="hljs-comment">// Instruction</span>
    <span class="hljs-keyword">let</span> builder = context.create_builder();
    builder.position_at_end(block);

    <span class="hljs-keyword">let</span> fizz_buzz_string_ptr = builder.build_global_string_ptr(<span class="hljs-string">"FizzBuzz\n"</span>, <span class="hljs-string">"fizz_buzz"</span>);
    <span class="hljs-keyword">let</span> fizz_string_ptr = builder.build_global_string_ptr(<span class="hljs-string">"Fizz\n"</span>, <span class="hljs-string">"fizz"</span>);
    <span class="hljs-keyword">let</span> buzz_string_ptr = builder.build_global_string_ptr(<span class="hljs-string">"Buzz\n"</span>, <span class="hljs-string">"buzz"</span>);

    <span class="hljs-keyword">let</span> param_0 = fizz_buzz_function
        .get_nth_param(<span class="hljs-number">0</span>)
        .unwrap()
        .into_int_value();

    <span class="hljs-keyword">let</span> rem_divied_by_3 =
        builder.build_int_signed_rem(param_0, i64_type.const_int(<span class="hljs-number">3</span>, <span class="hljs-literal">false</span>), <span class="hljs-string">"rem_3"</span>);
    <span class="hljs-keyword">let</span> rem_divied_by5 =
        builder.build_int_signed_rem(param_0, i64_type.const_int(<span class="hljs-number">5</span>, <span class="hljs-literal">false</span>), <span class="hljs-string">"rem_5"</span>);
    <span class="hljs-keyword">let</span> rem_divied_by15 =
        builder.build_int_signed_rem(param_0, i64_type.const_int(<span class="hljs-number">15</span>, <span class="hljs-literal">false</span>), <span class="hljs-string">"rem_15"</span>);

    <span class="hljs-keyword">let</span> comp_that_is_divisible_by_3 = builder.build_int_compare(
        EQ,
        rem_divied_by_3,
        i64_type.const_int(<span class="hljs-number">0</span>, <span class="hljs-literal">false</span>),
        <span class="hljs-string">"if_can_divide_by_3"</span>,
    );
    <span class="hljs-keyword">let</span> comp_that_is_divisible_by_5 = builder.build_int_compare(
        EQ,
        rem_divied_by5,
        i64_type.const_int(<span class="hljs-number">0</span>, <span class="hljs-literal">false</span>),
        <span class="hljs-string">"if_can_divide_by_5"</span>,
    );
    <span class="hljs-keyword">let</span> comp_that_is_divisible_by_15 = builder.build_int_compare(
        EQ,
        rem_divied_by15,
        i64_type.const_int(<span class="hljs-number">0</span>, <span class="hljs-literal">false</span>),
        <span class="hljs-string">"if_can_divide_by_15"</span>,
    );

    <span class="hljs-comment">// Block</span>
    <span class="hljs-keyword">let</span> fizz_buzz_block = context.append_basic_block(fizz_buzz_function, <span class="hljs-string">"fizz_buzz"</span>);
    <span class="hljs-keyword">let</span> fizz_block = context.append_basic_block(fizz_buzz_function, <span class="hljs-string">"fizz"</span>);
    <span class="hljs-keyword">let</span> buzz_block = context.append_basic_block(fizz_buzz_function, <span class="hljs-string">"buzz"</span>);
    <span class="hljs-keyword">let</span> num_block = context.append_basic_block(fizz_buzz_function, <span class="hljs-string">"num"</span>);
    <span class="hljs-keyword">let</span> else_1_block = context.append_basic_block(fizz_buzz_function, <span class="hljs-string">"else_1"</span>);
    <span class="hljs-keyword">let</span> else_2_block = context.append_basic_block(fizz_buzz_function, <span class="hljs-string">"else_2"</span>);
    <span class="hljs-keyword">let</span> end_block = context.append_basic_block(fizz_buzz_function, <span class="hljs-string">"end_block"</span>);

    <span class="hljs-comment">// Instruction</span>
    builder.build_conditional_branch(comp_that_is_divisible_by_15, fizz_buzz_block, else_1_block);
    builder.position_at_end(fizz_buzz_block);
    builder.build_call(
        printf_function,
        &amp;[fizz_buzz_string_ptr.as_pointer_value().into()],
        <span class="hljs-string">"print_fizz_buzz"</span>,
    );
    builder.build_unconditional_branch(end_block);

    <span class="hljs-comment">// Instruction</span>
    builder.position_at_end(else_1_block);
    builder.build_conditional_branch(comp_that_is_divisible_by_3, fizz_block, else_2_block);
    builder.position_at_end(fizz_block);
    builder.build_call(
        printf_function,
        &amp;[fizz_string_ptr.as_pointer_value().into()],
        <span class="hljs-string">"print_fizz"</span>,
    );
    builder.build_unconditional_branch(end_block);

    <span class="hljs-comment">// Instruction</span>
    builder.position_at_end(else_2_block);
    builder.build_conditional_branch(comp_that_is_divisible_by_5, buzz_block, num_block);
    builder.position_at_end(buzz_block);
    builder.build_call(
        printf_function,
        &amp;[buzz_string_ptr.as_pointer_value().into()],
        <span class="hljs-string">"print_buzz"</span>,
    );
    builder.build_unconditional_branch(end_block);

    <span class="hljs-comment">// Instruction</span>
    builder.position_at_end(num_block);
    builder.build_call(
        printf_function,
        &amp;[buzz_string_ptr.as_pointer_value().into()], <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Print input num.</span>
        <span class="hljs-string">"print_num"</span>,
    );
    builder.build_unconditional_branch(end_block);

    <span class="hljs-comment">// Instruction</span>
    builder.position_at_end(end_block);
    builder.build_return(<span class="hljs-literal">Some</span>(&amp;null));

    <span class="hljs-keyword">let</span> e = module.create_jit_execution_engine(OptimizationLevel::<span class="hljs-literal">None</span>)?;
    <span class="hljs-keyword">unsafe</span> {
        <span class="hljs-keyword">let</span> x = <span class="hljs-number">15u64</span>;
        e.get_function::&lt;<span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function"><span class="hljs-keyword">fn</span></span>(<span class="hljs-built_in">u64</span>) -&gt; ()&gt;(<span class="hljs-string">"fizz_buzz"</span>)?
            .call(x);
    }
    <span class="hljs-literal">Ok</span>(())
}
</code></pre>
<p>if文では、<code>build_conditional_branch</code>と<code>build_unconditional_branch</code>がどうやら使うそうです。
<a href="https://github.com/TheDan64/inkwell/blob/master/examples/kaleidoscope/main.rs">inkwell/examples/kaleidoscope/main.rs</a>で書いてありましたので、使ってみました。
実行してみます。15を引数として呼んでいます。</p>
<pre><code class="language-shell hljs"><span class="hljs-meta">$</span><span class="bash"> cargo run</span>
FizzBuzz
</code></pre>
<p>成功です！
ちなみに、IRも出力しておきます。</p>
<pre><code class="hljs llvm"><span class="hljs-comment">; ModuleID = 'fizz_buzz'</span>
source_filename <span class="hljs-operator">=</span> <span class="hljs-string">"fizz_buzz"</span>

<span class="hljs-title">@fizz_buzz.1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">unnamed_addr</span> <span class="hljs-keyword">constant</span> [<span class="hljs-number">10</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>] <span class="hljs-keyword">c</span><span class="hljs-string">"FizzBuzz\0A\00"</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">align</span> <span class="hljs-number">1</span>
<span class="hljs-title">@fizz</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">unnamed_addr</span> <span class="hljs-keyword">constant</span> [<span class="hljs-number">6</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>] <span class="hljs-keyword">c</span><span class="hljs-string">"Fizz\0A\00"</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">align</span> <span class="hljs-number">1</span>
<span class="hljs-title">@buzz</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">unnamed_addr</span> <span class="hljs-keyword">constant</span> [<span class="hljs-number">6</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>] <span class="hljs-keyword">c</span><span class="hljs-string">"Buzz\0A\00"</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">align</span> <span class="hljs-number">1</span>

<span class="hljs-keyword">declare</span> void <span class="hljs-title">@printf</span>(<span class="hljs-type">i8</span>*<span class="hljs-punctuation">,</span> ...)

<span class="hljs-keyword">define</span> <span class="hljs-type">i64</span> <span class="hljs-title">@fizz_buzz</span>(<span class="hljs-type">i64</span> <span class="hljs-variable">%0</span>) {
<span class="hljs-symbol">entry:</span>
  <span class="hljs-variable">%rem_3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">srem</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">3</span>
  <span class="hljs-variable">%rem_5</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">srem</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">5</span>
  <span class="hljs-variable">%rem_15</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">srem</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%0</span><span class="hljs-punctuation">,</span> <span class="hljs-number">15</span>
  <span class="hljs-variable">%if_can_divide_by_3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">icmp</span> <span class="hljs-keyword">eq</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%rem_3</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0</span>
  <span class="hljs-variable">%if_can_divide_by_5</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">icmp</span> <span class="hljs-keyword">eq</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%rem_5</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0</span>
  <span class="hljs-variable">%if_can_divide_by_15</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">icmp</span> <span class="hljs-keyword">eq</span> <span class="hljs-type">i64</span> <span class="hljs-variable">%rem_15</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0</span>
  <span class="hljs-keyword">br</span> <span class="hljs-type">i1</span> <span class="hljs-variable">%if_can_divide_by_15</span><span class="hljs-punctuation">,</span> label <span class="hljs-variable">%fizz_buzz</span><span class="hljs-punctuation">,</span> label <span class="hljs-variable">%else_1</span>

fizz_buzz:                                        <span class="hljs-comment">; preds = %entry</span>
  <span class="hljs-keyword">call</span> void (<span class="hljs-type">i8</span>*<span class="hljs-punctuation">,</span> ...) <span class="hljs-title">@printf</span>(<span class="hljs-type">i8</span>* <span class="hljs-keyword">getelementptr</span> <span class="hljs-keyword">inbounds</span> ([<span class="hljs-number">10</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]<span class="hljs-punctuation">,</span> [<span class="hljs-number">10</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]* <span class="hljs-title">@fizz_buzz.1</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span>))
  <span class="hljs-keyword">br</span> label <span class="hljs-variable">%end_block</span>
<span class="hljs-symbol">
fizz:</span>                                             <span class="hljs-comment">; preds = %else_1</span>
  <span class="hljs-keyword">call</span> void (<span class="hljs-type">i8</span>*<span class="hljs-punctuation">,</span> ...) <span class="hljs-title">@printf</span>(<span class="hljs-type">i8</span>* <span class="hljs-keyword">getelementptr</span> <span class="hljs-keyword">inbounds</span> ([<span class="hljs-number">6</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]<span class="hljs-punctuation">,</span> [<span class="hljs-number">6</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]* <span class="hljs-title">@fizz</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span>))
  <span class="hljs-keyword">br</span> label <span class="hljs-variable">%end_block</span>
<span class="hljs-symbol">
buzz:</span>                                             <span class="hljs-comment">; preds = %else_2</span>
  <span class="hljs-keyword">call</span> void (<span class="hljs-type">i8</span>*<span class="hljs-punctuation">,</span> ...) <span class="hljs-title">@printf</span>(<span class="hljs-type">i8</span>* <span class="hljs-keyword">getelementptr</span> <span class="hljs-keyword">inbounds</span> ([<span class="hljs-number">6</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]<span class="hljs-punctuation">,</span> [<span class="hljs-number">6</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]* <span class="hljs-title">@buzz</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span>))
  <span class="hljs-keyword">br</span> label <span class="hljs-variable">%end_block</span>
<span class="hljs-symbol">
num:</span>                                              <span class="hljs-comment">; preds = %else_2</span>
  <span class="hljs-keyword">call</span> void (<span class="hljs-type">i8</span>*<span class="hljs-punctuation">,</span> ...) <span class="hljs-title">@printf</span>(<span class="hljs-type">i8</span>* <span class="hljs-keyword">getelementptr</span> <span class="hljs-keyword">inbounds</span> ([<span class="hljs-number">6</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]<span class="hljs-punctuation">,</span> [<span class="hljs-number">6</span> <span class="hljs-keyword">x</span> <span class="hljs-type">i8</span>]* <span class="hljs-title">@buzz</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-type">i32</span> <span class="hljs-number">0</span>))
  <span class="hljs-keyword">br</span> label <span class="hljs-variable">%end_block</span>

else_<span class="hljs-number">1</span>:                                           <span class="hljs-comment">; preds = %entry</span>
  <span class="hljs-keyword">br</span> <span class="hljs-type">i1</span> <span class="hljs-variable">%if_can_divide_by_3</span><span class="hljs-punctuation">,</span> label <span class="hljs-variable">%fizz</span><span class="hljs-punctuation">,</span> label <span class="hljs-variable">%else_2</span>

else_<span class="hljs-number">2</span>:                                           <span class="hljs-comment">; preds = %else_1</span>
  <span class="hljs-keyword">br</span> <span class="hljs-type">i1</span> <span class="hljs-variable">%if_can_divide_by_5</span><span class="hljs-punctuation">,</span> label <span class="hljs-variable">%buzz</span><span class="hljs-punctuation">,</span> label <span class="hljs-variable">%num</span>

end_block:                                        <span class="hljs-comment">; preds = %num, %buzz, %fizz, %fizz_buzz</span>
  <span class="hljs-keyword">ret</span> <span class="hljs-type">i8</span>* <span class="hljs-keyword">null</span>
}
</code></pre>
<p>Blockがめちゃくちゃ増えました。それはFizzBuzzのif,elseが多いからですね。
LLVMについて、少し自信がついてきました。
これまで<code>中間言語 ~ コード生成</code>をLLVMでやってみました。
少し戻って、<code>字句解析 ~ 構文木</code>の部分、つまりパース処理をやってみます。</p>
<h2 id="四則演算するjavascriptをパース"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#四則演算するjavascriptをパース"></a>四則演算するJavascriptをパース</h2>
<p>javascriptをパースしてみます。<a href="https://rustdoc.swc.rs/swc_ecma_parser/">swc_ecma_parser</a>を使います。
パースするjavascriptは、次のものになります。</p>
<pre><code class="language-javascript hljs"><span class="hljs-comment">// ./src/test.js</span>
<span class="hljs-number">20</span> / <span class="hljs-number">10</span>
</code></pre>
<p>Rustのコードは、次のものになります。</p>
<pre><code class="language-rust hljs"><span class="hljs-meta">#[macro_use]</span>
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> swc_common;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> swc_ecma_ast;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> swc_ecma_parser;

<span class="hljs-keyword">use</span> std::path::Path;

<span class="hljs-keyword">use</span> swc_common::sync::Lrc;
<span class="hljs-keyword">use</span> swc_common::{
    errors::{ColorConfig, Handler},
    SourceMap,
};
<span class="hljs-keyword">use</span> swc_ecma_parser::{lexer::Lexer, Parser, StringInput, Syntax};

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
    <span class="hljs-keyword">let</span> cm: Lrc&lt;SourceMap&gt; = <span class="hljs-built_in">Default</span>::default();
    <span class="hljs-keyword">let</span> handler = Handler::with_tty_emitter(ColorConfig::Auto, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">Some</span>(cm.clone()));

    <span class="hljs-keyword">let</span> fm = cm
        .load_file(Path::new(<span class="hljs-string">"./src/test.js"</span>))
        .expect(<span class="hljs-string">"failed to load test.js"</span>);
    <span class="hljs-keyword">let</span> lexer = Lexer::new(
        Syntax::Es(<span class="hljs-built_in">Default</span>::default()),
        <span class="hljs-comment">// JscTarget defaults to es5</span>
        <span class="hljs-built_in">Default</span>::default(),
        StringInput::from(&amp;*fm),
        <span class="hljs-literal">None</span>,
    );

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> parser = Parser::new_from(lexer);

    <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> parser.take_errors() {
        e.into_diagnostic(&amp;handler).emit();
    }

    <span class="hljs-keyword">let</span> _module = parser
        .parse_module()
        .map_err(|<span class="hljs-keyword">mut</span> e| e.into_diagnostic(&amp;handler).emit())
        .expect(<span class="hljs-string">"failed to parser module"</span>);

    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{:?}"</span>, _module);
}
</code></pre>
<p>実行してみます。</p>
<pre><code class="language-shell hljs"><span class="hljs-meta">$</span><span class="bash"> cargo run</span>
Module { span: Span { lo: BytePos(0), hi: BytePos(8), ctxt: #0 }, body: [Stmt(Expr(ExprStmt { span: Span { lo: BytePos(0), hi: BytePos(8), ctxt: #0 }, expr: Bin(BinExpr { span: Span { lo: BytePos(0), hi: BytePos(7), ctxt: #0 }, op: "/", left: Lit(Num(Number { span: Span { lo: BytePos(0), hi: BytePos(2), ctxt: #0 }, value: 20.0 })), right: Lit(Num(Number { span: Span { lo: BytePos(5), hi: BytePos(7), ctxt: #0 }, value: 10.0 })) }) }))], shebang: None }
</code></pre>
<p>それっぽい結果(20.0や10.0)が出力されましたね！</p>
<h2 id="四則演算するjavascriptをllvmで実行"><a class="anchor" aria-label="Anchor" data-anchor-icon="##" href="#四則演算するjavascriptをllvmで実行"></a>四則演算するJavascriptをLLVMで実行</h2>
<p>最後に、swc_ecma_parserとLLVMを組み合わせて、<code>字句解析 ~ 構文木</code>と<code>中間言語 ~ コード生成</code>を繋げ、四則演算するJSをパースし、LLVMで実行してみます。</p>
<p>パースするjavascriptは、次のものになります。</p>
<pre><code class="language-javascript hljs"><span class="hljs-comment">// ./src/test.js</span>
<span class="hljs-number">20</span> / <span class="hljs-number">10</span>;
</code></pre>
<p>Rustのコードは、次のものになります。</p>
<pre><code class="language-rust hljs"><span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> inkwell;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> swc_common;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> swc_ecma_ast;
<span class="hljs-keyword">extern</span> <span class="hljs-keyword">crate</span> swc_ecma_parser;

<span class="hljs-keyword">use</span> inkwell::context::Context;
<span class="hljs-keyword">use</span> inkwell::OptimizationLevel;
<span class="hljs-keyword">use</span> std::error::Error;
<span class="hljs-keyword">use</span> std::path::Path;
<span class="hljs-keyword">use</span> swc_common::sync::Lrc;
<span class="hljs-keyword">use</span> swc_common::{
    errors::{ColorConfig, Handler},
    SourceMap,
};
<span class="hljs-keyword">use</span> swc_ecma_ast::Lit::Num;
<span class="hljs-keyword">use</span> swc_ecma_parser::{lexer::Lexer, Parser, StringInput, Syntax};

<span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() -&gt; <span class="hljs-built_in">Result</span>&lt;(), <span class="hljs-built_in">Box</span>&lt;<span class="hljs-keyword">dyn</span> Error&gt;&gt; {
    <span class="hljs-keyword">let</span> cm: Lrc&lt;SourceMap&gt; = <span class="hljs-built_in">Default</span>::default();
    <span class="hljs-keyword">let</span> handler = Handler::with_tty_emitter(ColorConfig::Auto, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">Some</span>(cm.clone()));

    <span class="hljs-keyword">let</span> fm = cm
        .load_file(Path::new(<span class="hljs-string">"./src/test.js"</span>))
        .expect(<span class="hljs-string">"failed to load test.js"</span>);
    <span class="hljs-keyword">let</span> lexer = Lexer::new(
        Syntax::Es(<span class="hljs-built_in">Default</span>::default()),
        <span class="hljs-built_in">Default</span>::default(),
        StringInput::from(&amp;*fm),
        <span class="hljs-literal">None</span>,
    );
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> parser = Parser::new_from(lexer);
    <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> parser.take_errors() {
        e.into_diagnostic(&amp;handler).emit();
    }
    <span class="hljs-keyword">let</span> _module = parser
        .parse_module()
        .map_err(|e| e.into_diagnostic(&amp;handler).emit())
        .expect(<span class="hljs-string">"failed to parser module"</span>);

    <span class="hljs-keyword">let</span> context = Context::create();
    <span class="hljs-keyword">let</span> module = context.create_module(<span class="hljs-string">"main"</span>);
    <span class="hljs-keyword">let</span> builder = context.create_builder();
    <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> _module.body {
        <span class="hljs-keyword">if</span> b.is_stmt() {
            <span class="hljs-keyword">let</span> stmt = b.stmt().unwrap();
            <span class="hljs-keyword">if</span> stmt.is_expr() {
                <span class="hljs-keyword">let</span> expr_stmt = stmt.expr().unwrap();
                <span class="hljs-keyword">let</span> expr = expr_stmt.expr;
                <span class="hljs-keyword">if</span> expr.is_bin() {
                    <span class="hljs-keyword">let</span> bin_expr = expr.bin().unwrap();
                    <span class="hljs-keyword">let</span> left_expr = bin_expr.left;
                    <span class="hljs-keyword">let</span> right_expr = bin_expr.right;
                    <span class="hljs-keyword">let</span> binary_op = bin_expr.op;
                    <span class="hljs-keyword">if</span> left_expr.is_lit() &amp;&amp; right_expr.is_lit() {
                        <span class="hljs-keyword">let</span> left_lit = left_expr.lit().unwrap();
                        <span class="hljs-keyword">let</span> right_lit = right_expr.lit().unwrap();
                        <span class="hljs-keyword">let</span> left_value = <span class="hljs-keyword">match</span> left_lit {
                            Num(n) =&gt; n.value,
                            _ =&gt; <span class="hljs-number">0f64</span>,
                        };
                        <span class="hljs-keyword">let</span> right_value = <span class="hljs-keyword">match</span> right_lit {
                            Num(n) =&gt; n.value,
                            _ =&gt; <span class="hljs-number">0f64</span>,
                        };
                        <span class="hljs-keyword">let</span> i64_type = context.i64_type();
                        <span class="hljs-keyword">let</span> void_type = context.void_type();
                        <span class="hljs-keyword">let</span> fn_type = void_type.fn_type(&amp;[], <span class="hljs-literal">false</span>);
                        <span class="hljs-keyword">let</span> function = module.add_function(<span class="hljs-string">"main"</span>, fn_type, <span class="hljs-literal">None</span>);
                        <span class="hljs-keyword">let</span> basic_block = context.append_basic_block(function, <span class="hljs-string">"entry"</span>);
                        builder.position_at_end(basic_block);
                        <span class="hljs-keyword">let</span> x = i64_type.const_int(left_value <span class="hljs-keyword">as</span> <span class="hljs-built_in">u64</span>, <span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">let</span> y = i64_type.const_int(right_value <span class="hljs-keyword">as</span> <span class="hljs-built_in">u64</span>, <span class="hljs-literal">true</span>);
                        <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">match</span> binary_op {
                            swc_ecma_ast::BinaryOp::Add =&gt; builder.build_int_add(x, y, <span class="hljs-string">"main"</span>),
                            swc_ecma_ast::BinaryOp::Sub =&gt; builder.build_int_sub(x, y, <span class="hljs-string">"main"</span>),
                            swc_ecma_ast::BinaryOp::Div =&gt; {
                                builder.build_int_signed_div(x, y, <span class="hljs-string">"main"</span>)
                            }
                            swc_ecma_ast::BinaryOp::Mul =&gt; builder.build_int_mul(x, y, <span class="hljs-string">"main"</span>),
                            _ =&gt; i64_type.const_int(<span class="hljs-number">0u64</span>, <span class="hljs-literal">true</span>),
                        };
                        builder.build_return(<span class="hljs-literal">Some</span>(&amp;result));
                        <span class="hljs-keyword">let</span> e = module.create_jit_execution_engine(OptimizationLevel::<span class="hljs-literal">None</span>)?;
                        <span class="hljs-keyword">unsafe</span> {
                            <span class="hljs-keyword">let</span> r = e
                                .get_function::&lt;<span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function"><span class="hljs-keyword">fn</span></span>() -&gt; <span class="hljs-built_in">u64</span>&gt;(<span class="hljs-string">"main"</span>)?
                                .call();
                            <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{:?}"</span>, r);
                        }
                    }
                }
            }
        }
    }
    <span class="hljs-literal">Ok</span>(())
}
</code></pre>
<p>実行してみます。</p>
<pre><code class="language-shell hljs"><span class="hljs-meta">$</span><span class="bash"> cargo run</span>
2
</code></pre>
<p><code>20 / 10</code>つまり、<code>2</code>が出力されました！やった！</p>
<h1 id="終わりに"><a class="anchor" aria-label="Anchor" data-anchor-icon="#" href="#終わりに"></a>終わりに</h1>
<p>これにて、簡単なjavascriptコードをパースし、LLVMで実行できるところまでたどり着きました。
当初、LLVMの使い方って全然わからなかったのですが、段階的にできる部分が増えると、分かる領域が増えて、モチベーションが高まります。
LLVMの勉強をされている方、参考にしてみてください。</p>
</main>
<amp-social-share type="twitter" aria-label="Share on Twitter" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:60px;height:44px;" i-amphtml-layout="fixed"></amp-social-share>
<amp-social-share type="hatena_bookmark" aria-label="Share on Hatena Bookmark" data-share-endpoint="http://b.hatena.ne.jp/entry/https://silver-birder.github.io/blog/contents/intro_to_LLVM-JIT_compilation_of_javascript_with_LLVM_Rust_inkwell" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:60px;height:44px;" i-amphtml-layout="fixed"></amp-social-share>
<amp-social-share type="facebook" aria-label="Share on Facebook" data-param-app_id="757288804895366" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:60px;height:44px;" i-amphtml-layout="fixed"></amp-social-share>
<amp-social-share type="rss" aria-label="RSS" data-share-endpoint="https://silver-birder.github.io/blog/feed.xml" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:60px;height:44px;" i-amphtml-layout="fixed"></amp-social-share>
<footer> <section> <a href="https://twitter.com/Silver_birder/"> <amp-img src="https://img.shields.io/twitter/follow/silver_birder?style=social" width="174" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:174px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://www.facebook.com/silverbirder/"> <amp-img src="https://img.shields.io/badge/facebook-social-green?logo=facebook" width="117" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:117px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://www.google.com/maps/contrib/101722346324226588907/reviews/@34.6907839,135.4537926,13z/"> <amp-img src="https://img.shields.io/badge/googleMaps-social-green?logo=google-maps" width="133" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:133px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://www.instagram.com/silverbirder/"> <amp-img src="https://img.shields.io/badge/instagram-social-green?logo=instagram" width="123" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:123px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> </section> <section> <a href="https://medium.com/@silverbirder"> <amp-img src="https://img.shields.io/badge/medium-blog-blue?logo=medium" width="105" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:105px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://note.com/silverbirder"> <amp-img src="https://img.shields.io/badge/note-blog-blue?logo=note" width="68" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:68px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://qiita.com/silverbirder"> <amp-img src="https://img.shields.io/badge/qiita-blog-blue?logo=qiita" width="83" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:83px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://scrapbox.io/silverbirder-memo"> <amp-img src="https://img.shields.io/badge/scrapbox-blog-blue?logo=scrapbox" width="92" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:92px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://silverbirder180.hatenablog.com/"> <amp-img src="https://img.shields.io/badge/hatenabookmark-blog-blue?logo=hatena-bookmark" width="153" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:153px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://zenn.dev/silverbirder"> <amp-img src="https://img.shields.io/badge/zenn-blog-blue?logo=zenn" width="87" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:87px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> </section> <section> <a href="https://github.com/Silver-birder"> <amp-img src="https://img.shields.io/badge/github-tech-red?logo=github" width="95" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:95px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://silverbirder.booth.pm/"> <amp-img src="https://img.shields.io/badge/booth-tech-red?logo=pixiv" width="91" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:91px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://speakerdeck.com/silverbirder"> <amp-img src="https://img.shields.io/badge/speakerDeck-tech-red?logo=speaker-deck" width="131" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:131px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="https://trello.com/b/RNbUvPFw/my-task"> <amp-img src="https://img.shields.io/badge/trello-tech-red?logo=trello" width="89" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:89px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> </section> <section> <a href="https://calendar.google.com/calendar/embed?src=silverbirder%40gmail.com&amp;ctz=Asia%2FTokyo"> <amp-img src="https://img.shields.io/badge/googleCalendar-contact-yellow?logo=google-calendar" width="163" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:163px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> <a href="mailto:silverbirder@gmail.com"> <amp-img src="https://img.shields.io/badge/gmail-contact-yellow?logo=gmail" width="109" height="20" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:109px;height:20px;" i-amphtml-layout="fixed"></amp-img> </a> </section>
</footer>
<amp-analytics type="gtag" data-credentials="include" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:1px;height:1px;" i-amphtml-layout="fixed"> <script type="application/json">{"vars":{"gtag_id":"UA-146805630-4","config":{"UA-146805630-4":{"groups":"default","linker":{"domains":["silver-birder.github.io"]}}}}}</script>
</amp-analytics> </body></html>