import{r as t,s as e,p as i}from"./a2a9827a.js";
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const r=(t,e)=>"method"===e.kind&&e.descriptor&&!("value"in e.descriptor)?{...e,finisher(i){i.createProperty(e.key,t)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:e.key,initializer(){"function"==typeof e.initializer&&(this[e.key]=e.initializer.call(this))},finisher(i){i.createProperty(e.key,t)}};function n(t){return(e,i)=>void 0!==i?((t,e,i)=>{e.constructor.createProperty(i,t)})(t,e,i):r(t,e)}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e,i,r){var n,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s}class h{constructor({html:t="",height:e="0px",width:i="0px"}){this.html="",this.height="0px",this.width="0px",this.html=t,this.height=e,this.width=i}}class a{constructor({name:t="",url:e="",endpoints:i=[]}){this.name="",this.url="",this.endpoints=[],this.name=t,this.url=e,this.endpoints=i}matchSchemeByUrl(t){return this._filterEndpoints(t).length>0}getUrlByMatchScheme(t){const e=this._filterEndpoints(t);return e.length>0?e[0].url:""}_filterEndpoints(t){return this.endpoints.filter((e=>{var i;return(null===(i=null==e?void 0:e.schemes)||void 0===i?void 0:i.filter((e=>{return(i=e,new RegExp(`^${i.split(/\*+/).map((t=>t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"))).join(".*")}$`)).test(t);var i})).length)>0}))}}class c{constructor(t,e){this.providerRepository=t,this.oEmbedRepository=e}async invoke(t){var e;const i=await this.providerRepository.lookup(t);return 0===i.length?new h({}):null===(e=this.oEmbedRepository)||void 0===e?void 0:e.get(`${i[0].getUrlByMatchScheme(t)}?url=${t}`)}}class d{constructor(t){this.proxy="",this.proxy=t}async _fetch(t){return(await fetch(`${this.proxy}/${t}`,{headers:{Origin:"null"}})).json()}async get(t){const e=await this._fetch(t);return new h({html:e.html,height:e.height,width:e.width})}}class l{constructor(t,e){this.proxy="",this.provider="",this.proxy=t,this.provider=e||"https://oembed.com/providers.json"}async _fetch(){return(await(await fetch(`${this.proxy}/${this.provider}`,{headers:{Origin:"null"}})).json()).map((t=>({providerName:t.provider_name,providerUrl:t.provider_url,endpoints:t.endpoints})))}async lookup(t){const e=(await this._fetch()).map((t=>new a({name:t.providerName,url:t.providerUrl,endpoints:t.endpoints})));return e.filter((e=>e.matchSchemeByUrl(t)))}}class p extends e{constructor(){super(...arguments),this.src="",this.proxy="",this.provider="",this._status="loading"}async connectedCallback(){super.connectedCallback(),this.proxy&&this.src?(void 0===this._interactor&&(this._interactor=new c(new l(this.proxy,this.provider),new d(this.proxy))),await this._updateOEmbed()):this.remove()}async willUpdate(t){(t.has("src")||t.has("proxy"))&&await this._updateOEmbed()}async _updateOEmbed(){var t;this._status="loading",null===(t=this._interactor)||void 0===t||t.invoke(this.src).then((t=>{""!==t.html?(this._oembed=t,this._status="loaded"):this._status="notFound"})).catch((()=>{this._status="error"}))}switchRender(){var t,e,r;const n=this.width?this.width:null===(t=this._oembed)||void 0===t?void 0:t.width,o=this.height?this.height:null===(e=this._oembed)||void 0===e?void 0:e.height;switch(this._status){case"loading":return i` <slot name="loading"></slot>`;case"notFound":return i` <slot name="notFound"></slot>`;case"error":return i` <slot name="error"></slot>`;default:return i`<iframe
          title="content"
          srcdoc="${null===(r=this._oembed)||void 0===r?void 0:r.html}"
          loading="lazy"
          width="${n}"
          height="${o}"
        ></iframe>`}}containerRender(){return i`<div>${this.switchRender()}</div>`}render(){return this.containerRender()}}p.styles=t`
    iframe {
      max-width: 100%;
      border: none;
    }
  `,s([n({type:String})],p.prototype,"src",void 0),s([n({type:String})],p.prototype,"height",void 0),s([n({type:String})],p.prototype,"width",void 0),s([n({type:String})],p.prototype,"proxy",void 0),s([n({type:String})],p.prototype,"provider",void 0),s([n({type:Object})],p.prototype,"_oembed",void 0),s([n({type:String})],p.prototype,"_status",void 0);const u=document.createElement("template");u.innerHTML='\n  <style>\n      p {\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .card {\n        max-width: 100%;\n      }\n      .container {\n        width: 100%;\n        background-color: #f2f3f5;\n      }\n      .container .img {\n        width: 100%;\n        height: auto;\n      }\n      .container .site {\n        color: #606770;\n        font-size: 12px;\n        text-transform: uppercase;\n      }\n      .container .title {\n        color: #000000;\n        font-weight: 600;\n      }\n      .container .description {\n        color: #606770;\n        font-size: 14px;\n        line-height: 28px;\n      }\n  </style>\n  <div class="card">\n    <div class="container">\n      <a class="link" href="#" target="_blank"><img class="img" /></a>\n      <p class="site"></p>\n      <p class="title"></p>\n      <p class="description"></p>\n    </div>\n  </div>\n  ';class y extends HTMLElement{constructor(){super(),o(this,"proxy",""),o(this,"src",""),o(this,"width",""),this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(u.content.cloneNode(!0))}connectedCallback(){this.proxy=this.getAttribute("proxy")||this.proxy,this.src=this.getAttribute("src")||this.src,this.width=this.getAttribute("width")||this.width,this._render()}_getContentAttribute(t,e){const i=t.querySelector(e);return null===i?"":i.getAttribute("content")}async _render(){const t=this.proxy?`${this.proxy}/${this.src}`:this.src,e=await(await fetch(t)).text(),i=(new DOMParser).parseFromString(e,"text/html"),r=this._getContentAttribute(i,"meta[property='og:image']"),n=this._getContentAttribute(i,"meta[property='og:site_name']"),o=this._getContentAttribute(i,"meta[property='og:title']"),s=this._getContentAttribute(i,"meta[property='og:description']");""!==r&&(this.shadowRoot.querySelector(".card").setAttribute("style",`width: ${this.width}`),this.shadowRoot.querySelector(".link").setAttribute("href",this.src),this.shadowRoot.querySelector(".img").setAttribute("src",r),this.shadowRoot.querySelector(".site").innerHTML=n,this.shadowRoot.querySelector(".title").innerHTML=o,this.shadowRoot.querySelector(".description").innerHTML=s)}}export{p as O,o as _,y as a};
