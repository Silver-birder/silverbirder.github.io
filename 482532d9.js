import{r as t,s as e,p as i}from"./a2a9827a.js";
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const r=(t,e)=>"method"===e.kind&&e.descriptor&&!("value"in e.descriptor)?{...e,finisher(i){i.createProperty(e.key,t)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:e.key,initializer(){"function"==typeof e.initializer&&(this[e.key]=e.initializer.call(this))},finisher(i){i.createProperty(e.key,t)}};function o(t){return(e,i)=>void 0!==i?((t,e,i)=>{e.constructor.createProperty(i,t)})(t,e,i):r(t,e)}function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function n(t,e,i,r){var o,s=arguments.length,n=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var h=t.length-1;h>=0;h--)(o=t[h])&&(n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n);return s>3&&n&&Object.defineProperty(e,i,n),n}class h{constructor({html:t="",height:e="0px",width:i="0px"}){this.html="",this.height="0px",this.width="0px",this.html=t,this.height=e,this.width=i}}class a{constructor({name:t="",url:e="",endpoints:i=[]}){this.name="",this.url="",this.endpoints=[],this.name=t,this.url=e,this.endpoints=i}matchSchemeByUrl(t){return this._filterEndpoints(t).length>0}getUrlByMatchScheme(t){const e=this._filterEndpoints(t);return e.length>0?e[0].url:""}_filterEndpoints(t){return this.endpoints.filter((e=>{var i;return(null===(i=null==e?void 0:e.schemes)||void 0===i?void 0:i.filter((e=>{return(i=e,new RegExp(`^${i.split(/\*+/).map((t=>t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"))).join(".*")}$`)).test(t);var i})).length)>0}))}}class d{constructor(t,e){this.providerRepository=t,this.oEmbedRepository=e}async invoke(t){var e;const i=await this.providerRepository.lookup(t);return 0===i.length?new h({}):null===(e=this.oEmbedRepository)||void 0===e?void 0:e.get(`${i[0].getUrlByMatchScheme(t)}?url=${t}`)}}class c{constructor(t){this.proxy="",this.proxy=t}async _fetch(t){return(await fetch(`${this.proxy}/${t}`,{headers:{Origin:"null"}})).json()}async get(t){const e=await this._fetch(t);return new h({html:e.html,height:e.height,width:e.width})}}class l{constructor(t,e){this.proxy="",this.provider="",this.proxy=t,this.provider=e||"https://oembed.com/providers.json"}async _fetch(){return(await(await fetch(`${this.proxy}/${this.provider}`,{headers:{Origin:"null"}})).json()).map((t=>({providerName:t.provider_name,providerUrl:t.provider_url,endpoints:t.endpoints})))}async lookup(t){const e=(await this._fetch()).map((t=>new a({name:t.providerName,url:t.providerUrl,endpoints:t.endpoints})));return e.filter((e=>e.matchSchemeByUrl(t)))}}class p extends e{constructor(){super(...arguments),this.src="",this.proxy="",this.provider="",this._status="loading"}async connectedCallback(){super.connectedCallback(),this.proxy&&this.src?(void 0===this._interactor&&(this._interactor=new d(new l(this.proxy,this.provider),new c(this.proxy))),await this._updateOEmbed()):this.remove()}async willUpdate(t){(t.has("src")||t.has("proxy"))&&await this._updateOEmbed()}async _updateOEmbed(){var t;this._status="loading",null===(t=this._interactor)||void 0===t||t.invoke(this.src).then((t=>{""!==t.html?(this._oembed=t,this._status="loaded"):this._status="notFound"})).catch((()=>{this._status="error"}))}switchRender(){var t,e,r;const o=this.width?this.width:null===(t=this._oembed)||void 0===t?void 0:t.width,s=this.height?this.height:null===(e=this._oembed)||void 0===e?void 0:e.height;switch(this._status){case"loading":return i` <slot name="loading"></slot>`;case"notFound":return i` <slot name="notFound"></slot>`;case"error":return i` <slot name="error"></slot>`;default:return i`<iframe
          title="content"
          srcdoc="${null===(r=this._oembed)||void 0===r?void 0:r.html}"
          loading="lazy"
          width="${o}"
          height="${s}"
        ></iframe>`}}containerRender(){return i`<div>${this.switchRender()}</div>`}render(){return this.containerRender()}}p.styles=t`
    iframe {
      max-width: 100%;
      border: none;
    }
  `,n([o({type:String})],p.prototype,"src",void 0),n([o({type:String})],p.prototype,"height",void 0),n([o({type:String})],p.prototype,"width",void 0),n([o({type:String})],p.prototype,"proxy",void 0),n([o({type:String})],p.prototype,"provider",void 0),n([o({type:Object})],p.prototype,"_oembed",void 0),n([o({type:String})],p.prototype,"_status",void 0);export{p as O,s as _};
